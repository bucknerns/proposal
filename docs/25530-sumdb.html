

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Proposal: Secure the Public Go Module Ecosystem &mdash; Go Design Proposal  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Go 1.5 Vendor Experiment" href="25719-go15vendor.html" />
    <link rel="prev" title="&lt;no title&gt;" href="25530-notary.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Go Design Proposal
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="11502-securitypolicy.html">Proposal: Security Policy for Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="11970-decentralized-gc.html">Proposal: Decentralized GC coordination</a></li>
<li class="toctree-l1"><a class="reference internal" href="12166-subtests.html">Proposal: testing: programmatic sub-test and sub-benchmark support</a></li>
<li class="toctree-l1"><a class="reference internal" href="12302-release-proposal.html">Proposal: A minimal release process for Go repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="12416-cgo-pointers.html">Proposal: Rules for passing pointers between Go and C</a></li>
<li class="toctree-l1"><a class="reference internal" href="12750-localization.html">Proposal: Localization support in Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="12800-sweep-free-alloc.html">Proposal: Dense mark bits and sweep-free allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="12914-monotonic.html">Proposal: Monotonic Elapsed Time Measurements in Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="12914-monotonic.html#appendix-time-now-usage">Appendix: time.Now usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="13073-code-of-conduct.html">Proposal: A Code of Conduct for the Go community</a></li>
<li class="toctree-l1"><a class="reference internal" href="13432-mobile-audio.html">Proposal: Audio for Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="13504-natural-xml.html">Proposal: Natural XML</a></li>
<li class="toctree-l1"><a class="reference internal" href="14313-benchmark-format.html">Proposal: Go Benchmark Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="14386-zip-package-archives.html">Proposal: Zip-based Go package archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="14951-soft-heap-limit.html">Proposal: Separate soft and hard heap size goal</a></li>
<li class="toctree-l1"><a class="reference internal" href="15292-generics.html">Proposal: Go should have generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="16085-conversions-ignore-tags.html">Proposal: Ignore tags in struct type conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="16339-alias-decls.html">Proposal: Alias declarations for Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="16339-alias-decls.html#appendix">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="16410-heap-viewer.html">Proposal: Go Heap Dump Viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="16704-cidr-notation-no-proxy.html">Proposal: Add support for CIDR notation in no_proxy variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="17280-profile-labels.html">Proposal: Support for pprof profiler labels</a></li>
<li class="toctree-l1"><a class="reference internal" href="17503-eliminate-rescan.html">Proposal: Eliminate STW stack re-scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="17505-concurrent-rescan.html">Proposal: Concurrent stack re-scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="18130-type-alias.html">Proposal: Type Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="18802-percpu-sharded.html">Proposal: percpu.Sharded, an API for reducing cache contention</a></li>
<li class="toctree-l1"><a class="reference internal" href="18802-percpu-sharded.html#discussion">Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="18802-percpu-sharded.html#backwards-compatibility">Backwards compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="19113-signed-shift-counts.html">Proposal: Permit Signed Integers as Shift Counts for Go 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="19308-number-literals.html">Proposal: Go 2 Number Literal Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html">Proposal: Mid-stack inlining in the Go compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#abstract">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#background">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#proposal">Proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#rationale">Rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#compatibility">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#implementation">Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#prerequisite-changes">Prerequisite Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#preliminary-results">Preliminary Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#open-issues">Open issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="19480-xml-stream.html">Proposal: XML Stream</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html">Proposal: emit DWARF inlining info in the Go compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#abstract">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#background">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#example">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#how-the-generated-dwarf-should-look">How the generated DWARF should look</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#outline-of-proposed-changes">Outline of proposed changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#compatibility">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#implementation">Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#prerequisite-changes">Prerequisite Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#preliminary-results">Preliminary Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#open-issues">Open issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="24301-versioned-go.html">Proposal: Versioned Go Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="24543-non-cooperative-preemption.html">Proposal: Non-cooperative goroutine preemption</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Proposal: Secure the Public Go Module Ecosystem</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#abstract">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#background">Background</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-authentication-with-go-sum">Module Authentication with <code class="docutils literal notranslate"><span class="pre">go.sum</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#transparent-logs">Transparent Logs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#proposal">Proposal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#checksum-database">Checksum Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#proxying-a-checksum-database">Proxying a Checksum Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="#go-command-client"><code class="docutils literal notranslate"><span class="pre">go</span></code> command client</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rationale">Rationale</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#security">Security</a></li>
<li class="toctree-l3"><a class="reference internal" href="#privacy">Privacy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#private-module-paths">Private Module Paths</a></li>
<li class="toctree-l4"><a class="reference internal" href="#private-module-sha256s">Private Module SHA256s</a></li>
<li class="toctree-l4"><a class="reference internal" href="#public-module-usage-information">Public Module Usage Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#privacy-by-proxy">Privacy by Proxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#privacy-by-bulk-download">Privacy by Bulk Download</a></li>
<li class="toctree-l4"><a class="reference internal" href="#privacy-in-ci-cd-systems">Privacy in CI/CD Systems</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compatibility">Compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation">Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="25719-go15vendor.html">Go 1.5 Vendor Experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="26160-dns-based-vanity-imports.html">Proposal: DNS Based Vanity Imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="26756-rawxml-token.html">Proposal: Raw XML Token</a></li>
<li class="toctree-l1"><a class="reference internal" href="26903-simplify-mark-termination.html">Proposal: Simplify mark termination and eliminate mark 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="27539-internal-abi.html">Proposal: Create an undefined internal calling convention</a></li>
<li class="toctree-l1"><a class="reference internal" href="2775-binary-only-packages.html">Proposal: Binary-Only Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="27935-unbounded-queue-package.html">Proposal: Built in support for high performance unbounded queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="28221-go2-transitions.html">Proposal: Go 2 transition</a></li>
<li class="toctree-l1"><a class="reference internal" href="2981-go-test-json.html">Proposal: <code class="docutils literal notranslate"><span class="pre">-json</span></code> flag in <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">test</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="29934-error-values.html">Proposal: Go 2 Error Inspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="30333-smarter-scavenging.html">Proposal: Smarter Scavenging</a></li>
<li class="toctree-l1"><a class="reference internal" href="30411-env.html">Proposal: <code class="docutils literal notranslate"><span class="pre">go</span></code> command configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="32437-try-builtin.html">Proposal: A built-in Go error check function, <code class="docutils literal notranslate"><span class="pre">try</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="33974-add-public-lockedfile-pkg.html">Proposal: make the internal lockedfile package public</a></li>
<li class="toctree-l1"><a class="reference internal" href="34481-opencoded-defers.html">Proposal: Low-cost defers through inline code, and extra funcdata to manage the panic case</a></li>
<li class="toctree-l1"><a class="reference internal" href="35112-scaling-the-page-allocator.html">Proposal: Scaling the Go page allocator</a></li>
<li class="toctree-l1"><a class="reference internal" href="36460-lazy-module-loading.html">Proposal: Lazy Module Loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="36606-64-bit-field-alignment.html">Proposal: Make 64-bit fields be 64-bit aligned on 32-bit systems, add //go:packed, //go:align directives</a></li>
<li class="toctree-l1"><a class="reference internal" href="37112-unstable-runtime-metrics.html">Proposal: API for unstable runtime metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="37720-gopls-workspaces.html">Proposal: Multi-project gopls workspaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="4899-testing-helper.html">Proposal: testing: better support test helper functions with TB.Helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="6282-table-data.html">Proposal: Multi-dimensional slices</a></li>
<li class="toctree-l1"><a class="reference internal" href="6977-overlapping-interfaces.html">Proposal: Permit embedding of interfaces with overlapping method sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="TEMPLATE.html">Proposal: [Title]</a></li>
<li class="toctree-l1"><a class="reference internal" href="cryptography-principles.html">Cryptography Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft.html">Go 2 Draft Designs</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-contracts.html">Contracts — Draft Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-handling.html">Error Handling — Draft Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-handling-overview.html">Error Handling — Problem Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-inspection.html">Error Inspection — Draft Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-printing.html">Error Printing — Draft Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-values-overview.html">Error Values — Problem Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-generics-overview.html">Generics — Problem Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-type-parameters.html">Type Parameters - Draft Design</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Go Design Proposal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Proposal: Secure the Public Go Module Ecosystem</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/25530-sumdb.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="proposal-secure-the-public-go-module-ecosystem">
<h1>Proposal: Secure the Public Go Module Ecosystem<a class="headerlink" href="#proposal-secure-the-public-go-module-ecosystem" title="Permalink to this headline">¶</a></h1>
<p>Russ Cox<br />Filippo Valsorda</p>
<p>Last updated: April 24, 2019.</p>
<p><a class="reference external" href="https://golang.org/design/25530-sumdb">golang.org/design/25530-sumdb</a></p>
<p>Discussion at <a class="reference external" href="https://golang.org/issue/25530">golang.org/issue/25530</a>.</p>
<div class="section" id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>We propose to secure the public Go module ecosystem
by introducing a new server, the Go checksum database,
which serves what is in effect a <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> file
listing all publicly-available Go modules.
The <code class="docutils literal notranslate"><span class="pre">go</span></code> command will use this service to fill in gaps
in its own local <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> files,
such as during <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">get</span> <span class="pre">-u</span></code>.
This ensures that unexpected code changes cannot
be introduced when first adding a dependency to a module
or when upgrading a dependency.</p>
<p>The original name for the Go checksum database was “the Go notary,”
but we have stopped using that name to avoid confusion
with the CNCF Notary project, itself written in Go,
not to mention the Apple Notary.</p>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>When you run <code class="docutils literal notranslate"><span class="pre">go</span></code> <code class="docutils literal notranslate"><span class="pre">get</span></code> <code class="docutils literal notranslate"><span class="pre">rsc.io/quote&#64;v1.5.2</span></code>, <code class="docutils literal notranslate"><span class="pre">go</span></code> <code class="docutils literal notranslate"><span class="pre">get</span></code> first fetches
<code class="docutils literal notranslate"><span class="pre">https://rsc.io/quote?go-get=1</span></code> and looks for <code class="docutils literal notranslate"><span class="pre">&lt;meta&gt;</span></code> tags. It finds</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">meta</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;go-import&quot;</span>
      <span class="n">content</span><span class="o">=</span><span class="s2">&quot;rsc.io/quote git https://github.com/rsc/quote&quot;</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>which tells it the code is in a Git repository on <code class="docutils literal notranslate"><span class="pre">github.com</span></code>.
Next it runs <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/rsc/quote</span></code> to fetch
the Git repository and then extracts the file tree from the <code class="docutils literal notranslate"><span class="pre">v1.5.2</span></code> tag,
producing the actual module archive.</p>
<p>Historically, <code class="docutils literal notranslate"><span class="pre">go</span></code> <code class="docutils literal notranslate"><span class="pre">get</span></code> has always simply assumed that it was downloading
the right code.
An attacker able to intercept the connection to <code class="docutils literal notranslate"><span class="pre">rsc.io</span></code> or <code class="docutils literal notranslate"><span class="pre">github.com</span></code>
(or an attacker able to break into one of those systems, or a malicious module author)
would be able to cause <code class="docutils literal notranslate"><span class="pre">go</span></code> <code class="docutils literal notranslate"><span class="pre">get</span></code> to download different code tomorrow,
and <code class="docutils literal notranslate"><span class="pre">go</span></code> <code class="docutils literal notranslate"><span class="pre">get</span></code> would not notice.</p>
<p>There are
<a class="reference external" href="https://research.swtch.com/deps">many challenges in using software dependencies safely</a>,
and much more vetting should typically be done before taking on a
new dependency, but no amount of vetting is worth anything
if the code you download and vet today
differs from the code you or a collaborator downloads
tomorrow for the “same” module version.
We must be able to authenticate whether a particular
download is correct.</p>
<p>For our purposes, “correct” for a particular module version download
is defined as the same code everyone else downloads.
This definition ensures reproducibility of builds
and makes vetting of specific module versions meaningful,
without needing to attribute specific archives to
specific authors,
and without introducing new potential points of compromise
like per-author keys.
(Also, even the author of a module should not be able to change
the bits associated with a specific version from one day to the next.)</p>
<p>Being able to authenticate a particular module version download
effectively moves code hosting servers like <code class="docutils literal notranslate"><span class="pre">rsc.io</span></code> and <code class="docutils literal notranslate"><span class="pre">github.com</span></code>
out of the trusted computing base of the Go module ecosystem.
With module authentication, those servers could cause availability problems
by not serving a module version anymore,
but they cannot substitute different code.
The introduction of Go module proxies (see <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">help</span> <span class="pre">goproxy</span></code>)
introduces yet another way for an attacker to intercept module downloads;
module authentication eliminates the need to trust those proxies as well,
moving them outside
<a class="reference external" href="https://www.microsoft.com/en-us/research/publication/authentication-in-distributed-systems-theory-and-practice/">trusted computing base</a>.</p>
<p>See the Go blog post “<a class="reference external" href="https://blog.golang.org/modules2019">Go Modules in 2019</a>”
for additional background.</p>
<div class="section" id="module-authentication-with-go-sum">
<h3>Module Authentication with <code class="docutils literal notranslate"><span class="pre">go.sum</span></code><a class="headerlink" href="#module-authentication-with-go-sum" title="Permalink to this headline">¶</a></h3>
<p>Go 1.11’s preview of Go modules introduced the <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> file,
which is maintained automatically by the <code class="docutils literal notranslate"><span class="pre">go</span></code> command
in the root of a module tree
and contains cryptographic checksums for the content of each
dependency of that module.
If a module’s source file tree is obtained unmodified,
then the <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> file allows authenticating all dependencies
needed for a build of that module.
It ensures that tomorrow’s builds will use the same exact
code for dependencies that today’s builds did.
Tomorrow’s downloads are authenticated by <code class="docutils literal notranslate"><span class="pre">go.sum</span></code>.</p>
<p>On the other hand, today’s downloads—the ones that add or update
dependencies in the first place—are not authenticated.
When a dependency is first added to a module,
or when a dependency is upgraded to a newer version,
there is no entry for it in <code class="docutils literal notranslate"><span class="pre">go.sum</span></code>,
and the <code class="docutils literal notranslate"><span class="pre">go</span></code> command today blindly trusts that it
downloads the correct code.
Then it records the hash of that code into <code class="docutils literal notranslate"><span class="pre">go.sum</span></code>
to ensure that code doesn’t change tomorrow.
But that doesn’t help the initial download.
The model is similar to SSH’s
“<a class="reference external" href="https://en.wikipedia.org/wiki/Trust_on_first_use">trust on first use</a>,”
and while that approach is an improvement over “trust every time,”
it’s still not ideal,
especially since developers typically download new module versions
far more often than they connect to new, unknown SSH servers.</p>
<p>We are concerned primarily with authenticating downloads
of publicly-available module versions.
We assume that the private servers hosting
private module source code are already within the
trusted computing base of the developers using that code.
In contrast, a developer who wants to use <code class="docutils literal notranslate"><span class="pre">rsc.io/quote</span></code>
should not be required to trust that <code class="docutils literal notranslate"><span class="pre">rsc.io</span></code> is properly secured.
This trust becomes particularly problematic when summed
over all dependencies.</p>
<p>What we need is an easily-accessed <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> file listing every
publicly-available module version.
But we don’t want to blindly trust a downloaded <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> file,
since that would become the next attractive target for an attacker.</p>
</div>
<div class="section" id="transparent-logs">
<h3>Transparent Logs<a class="headerlink" href="#transparent-logs" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://www.certificate-transparency.org/">Certificate Transparency</a> project
is based on a data structure called a <em>transparent log</em>.
The transparent log is hosted on a server and made accessible to clients for random access,
but clients are still able to verify that a particular log record really is in the log
and also that the server never removes any log record from the log.
Separately, third-party auditors can iterate over the log
checking that the entries themselves are accurate.
These two properties combined mean that
a client can use records from the log,
confident that those records will remain available in the log
for auditors to double-check and report invalid or suspicious entries.
Clients and auditors can also compare observations to ensure
that the server is showing the same data to everyone involved.</p>
<p>That is, the log server is not trusted to store the log properly,
nor is it trusted to put the right records into the log.
Instead, clients and auditors interact skeptically with the server,
able to verify for themselves in each interaction
that the server really is behaving correctly.</p>
<p>For details about the data structure, see Russ Cox’s blog post,
“<a class="reference external" href="https://research.swtch.com/tlog">Transparent Logs for Skeptical Clients</a>.”
For a high-level overview of Certificate Transparency
along with additional motivation and context,
see Ben Laurie’s ACM Queue article,
“<a class="reference external" href="https://queue.acm.org/detail.cfm?id=2668154">Certificate Transparency: Public, verifiable, append-only logs</a>.”</p>
<p>The use of a transparent log for module hashes aligns with
a broader trend of using transparent logs to enable detection
of misbehavior by partially trusted systems,
what the Trillian team calls
“<a class="reference external" href="https://github.com/google/trillian/#trillian-general-transparency">General Transparency</a>.”</p>
</div>
</div>
<div class="section" id="proposal">
<h2>Proposal<a class="headerlink" href="#proposal" title="Permalink to this headline">¶</a></h2>
<p>We propose to publish the <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> lines for all publicly-available Go modules
in a transparent log,
served by a new server called the Go checksum database.
When a publicly-available module is not yet listed in
the main module’s <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> file,
the <code class="docutils literal notranslate"><span class="pre">go</span></code> command will fetch the relevant <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> lines
from the checksum database instead of trusting the initial download
to be correct.</p>
<div class="section" id="checksum-database">
<h3>Checksum Database<a class="headerlink" href="#checksum-database" title="Permalink to this headline">¶</a></h3>
<p>The Go checksum database will run at <code class="docutils literal notranslate"><span class="pre">https://sum.golang.org/</span></code> and serve the following endpoints:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/latest</span></code> will serve a signed tree size and hash for the latest log.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/lookup/M&#64;V</span></code> will serve the log record number for the entry about module M version V,
followed by the data for the record (that is, the <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> lines for module M version V)
and a signed tree hash for a tree that contains the record.
If the module version is not yet recorded in the log, the notary will try to fetch it before replying.
Note that the data should never be used without first
authenticating it against the signed tree hash
and authenticating the signed tree hash against the client’s
timeline of signed tree hashes.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/tile/H/L/K[.p/W]</span></code> will serve a <a class="reference external" href="https://research.swtch.com/tlog#serving_tiles">log tile</a>.
The optional <code class="docutils literal notranslate"><span class="pre">.p/W</span></code> suffix indicates a partial log tile with only <code class="docutils literal notranslate"><span class="pre">W</span></code> hashes.
Clients must fall back to fetching the full tile if a partial tile is not found.
The record data for the leaf hashes in <code class="docutils literal notranslate"><span class="pre">/tile/H/0/K[.p/W]</span></code> are served as <code class="docutils literal notranslate"><span class="pre">/tile/H/data/K[.p/W]</span></code>
(with a literal <code class="docutils literal notranslate"><span class="pre">data</span></code> path element).</p></li>
</ul>
<p>Clients are expected to use <code class="docutils literal notranslate"><span class="pre">/lookup</span></code> and <code class="docutils literal notranslate"><span class="pre">/tile/H/L/...</span></code> during normal operations,
while auditors will want to use <code class="docutils literal notranslate"><span class="pre">/latest</span></code> and <code class="docutils literal notranslate"><span class="pre">/tile/H/data/...</span></code>.
A special <code class="docutils literal notranslate"><span class="pre">go</span></code> command may also fetch <code class="docutils literal notranslate"><span class="pre">/latest</span></code> to force incorporation
of that signed tree head into the local timeline.</p>
</div>
<div class="section" id="proxying-a-checksum-database">
<h3>Proxying a Checksum Database<a class="headerlink" href="#proxying-a-checksum-database" title="Permalink to this headline">¶</a></h3>
<p>A module proxy can also proxy requests to the checksum database.
The general proxy URL form is <code class="docutils literal notranslate"><span class="pre">&lt;proxyURL&gt;/sumdb/&lt;databaseURL&gt;</span></code>.
If <code class="docutils literal notranslate"><span class="pre">GOPROXY=https://proxy.site</span></code> then the latest signed tree would be fetched using
<code class="docutils literal notranslate"><span class="pre">https://proxy.site/sumdb/sum.golang.org/latest</span></code>.
Including the full database URL allows a transition to a new database log,
such as <code class="docutils literal notranslate"><span class="pre">sum.golang.org/v2</span></code>.</p>
<p>Before accessing any checksum database URL using a proxy,
the proxy client should first fetch <code class="docutils literal notranslate"><span class="pre">&lt;proxyURL&gt;/sumdb/&lt;sumdb-name&gt;/supported</span></code>.
If that request returns a successful (HTTP 200) response,
then the proxy supports proxying checksum database requests.
In that case, the client should use the proxied access method only,
never falling back to a direct connection to the database.
If the <code class="docutils literal notranslate"><span class="pre">/sumdb/&lt;sumdb-name&gt;/supported</span></code> check fails with a “not found” (HTTP 404)
or “gone” (HTTP 410) response,
the proxy is unwilling to proxy the checksum database,
and the client should connect directly to the database.
Any other response is treated as the database being unavailable.</p>
<p>A corporate proxy may want to ensure that clients
never make any direct database connections
(for example, for privacy; see the “Rationale” section below).
The optional <code class="docutils literal notranslate"><span class="pre">/sumdb/supported</span></code> endpoint, along with
proxying actual database requests, lets such a proxy
ensure that a <code class="docutils literal notranslate"><span class="pre">go</span></code> command using the proxy
never makes a direct connection to sum.golang.org.
But simpler proxies may wish to focus on serving
only modules and not checksum data—in particular,
module-only proxies can be served from entirely static file systems,
with no special infrastructure at all.
Such proxies can respond with an HTTP 404 or HTTP 410 to
the <code class="docutils literal notranslate"><span class="pre">/sumdb/supported</span></code> endpoint, so that clients
will connect to the database directly.</p>
</div>
<div class="section" id="go-command-client">
<h3><code class="docutils literal notranslate"><span class="pre">go</span></code> command client<a class="headerlink" href="#go-command-client" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">go</span></code> command is the primary consumer of the database’s published log.
The <code class="docutils literal notranslate"><span class="pre">go</span></code> command will <a class="reference external" href="https://research.swtch.com/tlog#verifying_a_log">verify the log</a>
as it uses it,
ensuring that every record it reads is actually in the log
and that no observed log ever drops a record from an earlier observed log.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">go</span></code> command will refer to <code class="docutils literal notranslate"><span class="pre">$GOSUMDB</span></code> to find the name and public key
of the Go checksum database.
That variable will default to the <code class="docutils literal notranslate"><span class="pre">sum.golang.org</span></code> server.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">go</span></code> command will cache the latest signed tree size and tree hash
in <code class="docutils literal notranslate"><span class="pre">$GOPATH/pkg/sumdb/&lt;sumdb-name&gt;/latest</span></code>.
It will cache lookup results and tiles in
<code class="docutils literal notranslate"><span class="pre">$GOPATH/pkg/mod/download/cache/sumdb/&lt;sumdb-name&gt;/lookup/path&#64;version</span></code>
and <code class="docutils literal notranslate"><span class="pre">$GOPATH/pkg/mod/download/cache/sumdb/&lt;sumdb-name&gt;/tile/H/L/K[.W]</span></code>.
(More generally, <code class="docutils literal notranslate"><span class="pre">https://&lt;sumdb-URL&gt;</span></code> is cached
in <code class="docutils literal notranslate"><span class="pre">$GOPATH/pkg/mod/download/cache/sumdb/&lt;sumdb-URL&gt;</span></code>.)
This way, <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">clean</span> <span class="pre">-modcache</span></code> deletes cached lookup results and tiles
but not the latest signed tree hash, which should be preserved for
detection of timeline inconsistency.
No <code class="docutils literal notranslate"><span class="pre">go</span></code> command (only a manual <code class="docutils literal notranslate"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">$GOPATH/pkg</span></code>)
will wipe out the memory of the latest observed tree size and hash.
If the <code class="docutils literal notranslate"><span class="pre">go</span></code> command ever does observe a pair of inconsistent signed tree sizes and hashes,
it will complain loudly on standard error and fail the build.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">go</span></code> command must be configured to know which modules are
publicly available and therefore can be looked up in the checksum database,
versus those that are closed source and must not be looked up,
especially since that would transmit potentially private import paths
over the network to the database <code class="docutils literal notranslate"><span class="pre">/lookup</span></code> endpoint.
A few new environment variables control this configuration.
(See the <a class="reference external" href="https://golang.org/design/30411-env"><code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">env</span> <span class="pre">-w</span></code> proposal</a>,
now available in the Go 1.13 development branch,
for a way to manage these variables more easily.)</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">GOPROXY=https://proxy.site/path</span></code> sets the Go module proxy to use, as before.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GONOPROXY=prefix1,prefix2,prefix3</span></code> sets a list of module path prefixes,
possibly containing globs, that should not be proxied.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GONOPROXY</span><span class="o">=*.</span><span class="n">corp</span><span class="o">.</span><span class="n">google</span><span class="o">.</span><span class="n">com</span><span class="p">,</span><span class="n">rsc</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">private</span>
</pre></div>
</div>
<p>will bypass the proxy for the modules foo.corp.google.com, foo.corp.google.com/bar, rsc.io/private, and rsc.io/private/bar,
though not rsc.io/privateer (the patterns are path prefixes, not string prefixes).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">GOSUMDB=&lt;sumdb-key&gt;</span></code> sets the Go checksum database to use,
where <code class="docutils literal notranslate"><span class="pre">&lt;sumdb-key&gt;</span></code> is a verifier key as defined in
<a class="reference external" href="https://godoc.org/golang.org/x/mod/sumdb/note#hdr-Verifying_Notes">package note</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GONOSUMDB=prefix1,prefix2,prefix3</span></code> sets a list of module path prefixes,
again possibly containing globs, that should not be looked up using the database.</p>
<p>We expect that corporate environments may fetch all modules, public and private,
through an internal proxy;
<code class="docutils literal notranslate"><span class="pre">GONOSUMDB</span></code> allows them to disable checksum database lookups for
internal modules while still verifying public modules.
Therefore, <code class="docutils literal notranslate"><span class="pre">GONOSUMDB</span></code> must not imply <code class="docutils literal notranslate"><span class="pre">GONOPROXY</span></code>.</p>
<p>We also expect that other users may prefer to connect directly to source origins
but still want verification of open source modules or proxying of the database itself;
<code class="docutils literal notranslate"><span class="pre">GONOPROXY</span></code> allows them to arrange that and therefore must not imply <code class="docutils literal notranslate"><span class="pre">GONOSUMDB</span></code>.</p>
</li>
</ul>
<p>The database not being able to report <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> lines for a module version
is a hard failure:
any private modules must be explicitly listed in <code class="docutils literal notranslate"><span class="pre">$GONOSUMDB</span></code>.
(Otherwise an attacker could block traffic to the database
and make all module versions appear to be genuine.)
The database can be disabled entirely with <code class="docutils literal notranslate"><span class="pre">GONOSUMDB=*</span></code>.
The command <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">get</span> <span class="pre">-insecure</span></code> will report but not stop after database lookup
failures or database mismatches.</p>
</div>
</div>
<div class="section" id="rationale">
<h2>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<p>The motivation for authenticating module downloads is
covered in the background section above.
Note that we want to authenticate modules
obtained both from direct connections to code-hosting servers
and from module proxies.</p>
<p>Two topics are worth further discussion:
first, having a single database server for the entire Go ecosystem,
and second, the privacy implications of a database server.</p>
<div class="section" id="security">
<h3>Security<a class="headerlink" href="#security" title="Permalink to this headline">¶</a></h3>
<p>The Go team at Google will run the Go checksum database as a service to the Go ecosystem,
similar to running <code class="docutils literal notranslate"><span class="pre">godoc.org</span></code> and <code class="docutils literal notranslate"><span class="pre">golang.org</span></code>.
It is important that the service be secure.
Our thinking about the security design of the database has evolved over time,
and it is useful to outline the evolution that led to the
current design.</p>
<p>The simplest possible approach, which we never seriously considered,
is to have one trusted server that issues a signed certificate for each
module version.
The drawback of this approach is that a compromised server
can be used to sign a certificate for a compromised module version,
and then that compromised module version and certificate
can be served to a target victim without easy detection.</p>
<p>One way to address this weakness is strength in numbers:
have, say, N=3 or N=5 organizations run independent servers,
gather certificates from all of them, and accept a module version
as valid when, say, (N+1)/2 certificates agree.
The two drawbacks of this approach are that it is significantly more expensive
and still provides no detection of actual attacks.
The payoff from targeted replacement of source code
could be high enough to justify silently compromising (N+1)/2
notaries and then making very selective use of the certificates.
So our focus turned to detection of compromise.</p>
<p>Requiring a checksum database to log a <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> entry in a
<a class="reference external" href="https://research.swtch.com/tlog">transparent log</a>
before accepting it does raise the likelihood of detection.
If the compromised <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> entry is stored in the
actual log, an auditor can find it.
And if the compromised <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> entry is served in
a forked, victim-specific log, the server must always serve
that forked log to the victim, and only to the victim,
or else the <code class="docutils literal notranslate"><span class="pre">go</span></code> command’s consistency checks will fail
loudly, and with enough information to cryptographically
prove the compromise of the server.</p>
<p>An ecosystem with multiple proxies run by different organizations
makes a successful “forked log” attack even harder:
the attacker would have to not only compromise the database,
it would also have to compromise each possible proxy the
victim might use and arrange to identify the victim well enough
to always serve the forked log to the victim
and to never serve it to any non-victim.</p>
<p>The serving of the transparent log in tile form helps
caching and proxying but also makes victim identification
that much harder.
When using Certificate Transparency’s proof endpoints,
the proof requests might be arranged to carry enough
material to identify a victim, for example by only ever serving an
even log sizes to the victim and odd log sizes to others
and then adjusting the log-size-specific proofs accordingly.
But complete tile fetches expose no information about the cached log size,
making it that much harder to serve modified tiles only to the victim.</p>
<p>We hope that proxies run by various
organizations in the Go community will also serve as auditors
and double-check Go checksum database log entries
as part of their ordinary operation.
(Another useful
service that could be enabled by
the database is a notification service to alert
authors about new versions of their own modules.)</p>
<p>As described earlier,
users who want to ensure their own compromise requires
compromising multiple organizations can use Google’s checksum database
and a different organization’s proxy to access it.</p>
<p>Generalizing that approach,
the usual way to further improve detection of fork attacks is to add gossip,
so that different users can check whether they are seeing
different logs.
In effect, the proxy protocol already supports this,
so that any available proxy that proxies the database
can be a gossip source.
If we add a  <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">fetch-latest-chccksum-log-from-goproxy</span></code> (obviously not the final name)
and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GOPROXY</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">other</span><span class="o">.</span><span class="n">proxy</span><span class="o">/</span> <span class="n">go</span> <span class="n">fetch</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="n">checksum</span><span class="o">-</span><span class="n">log</span><span class="o">-</span><span class="n">from</span><span class="o">-</span><span class="n">goproxy</span>
</pre></div>
</div>
<p>succeeds, then the client and other.proxy are seeing the same log.</p>
<p>Compared to the original scenario of a single checksum database with
no transparent log, the use of a single transparent log
and the ability to proxy the database and gossip improves
detection of attacks so much that there is little incremental
security benefit to adding the complexity of multiple notaries.
At some point in the future, it might make sense for the
Go ecosystem to support using multiple databases,
but to begin with we have opted for the simpler
(but still reasonably secure) ecosystem design
of a single database.</p>
</div>
<div class="section" id="privacy">
<h3>Privacy<a class="headerlink" href="#privacy" title="Permalink to this headline">¶</a></h3>
<p>Contacting the Go checksum database to authenticate a new dependency
requires sending the module path and version to the database server.</p>
<p>The database server will of course need to publish a privacy policy,
and it should be written as clearly as
the <a class="reference external" href="https://developers.google.com/speed/public-dns/privacy">Google Public DNS Privacy Policy</a>
and be sure to include information about log retention windows.
That policy is still under development.
But the privacy policy only matters for data the database receives.
The design of the database protocol and usage is meant to minimize
what the <code class="docutils literal notranslate"><span class="pre">go</span></code> command even sends.</p>
<p>There are two main privacy concerns:
exposing the text of private modules paths to the database,
and exposing usage information for public modules to the databas.</p>
<div class="section" id="private-module-paths">
<h4>Private Module Paths<a class="headerlink" href="#private-module-paths" title="Permalink to this headline">¶</a></h4>
<p>The first main privacy concern is that a misconfigured <code class="docutils literal notranslate"><span class="pre">go</span></code> command
could send the text of a private module path
(for example, <code class="docutils literal notranslate"><span class="pre">secret-machine.rsc.io/private/secret-plan</span></code>) to the database.
The database will try to resolve the module, triggering a DNS lookup
for <code class="docutils literal notranslate"><span class="pre">secret-machine.rsc.io</span></code> and, if that resolves, an HTTPS fetch
for the longer URL.
Even if the database then discards that path immediately upon failure,
it has still been sent over the network.</p>
<p>Such misconfiguration must not go unnoticed.
For this reason (and also to avoid downgrade attacks),
if the database cannot return information about a module,
the download fails loudly and the <code class="docutils literal notranslate"><span class="pre">go</span></code> command stops.
This ensures both that all public modules are in fact
authenticated and also that any misconfiguration
must be corrected (by setting <code class="docutils literal notranslate"><span class="pre">$GONOSUMDB</span></code> to avoid
the database for those private modules)
in order to achieve a successful build.
This way, the frequency of misconfiguration-induced
database lookups should be minimized.
Misconfigurations fail; they will be noticed and fixed.</p>
<p>One possibility to further reduce exposure of private module path text
is to provide additional ways to
set <code class="docutils literal notranslate"><span class="pre">$GONOSUMDB</span></code>, although it is not clear what those
should be.
A top-level module’s source code repository is an attractive place to
want to store configuration such as <code class="docutils literal notranslate"><span class="pre">$GONOSUMDB</span></code>
and <code class="docutils literal notranslate"><span class="pre">$GOPROXY</span></code>, but then that configuration changes
depending on which version of the repo is checked out,
which would cause interesting behavior when testing old
versions, whether by hand or using tools like <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">bisect</span></code>.</p>
<p>(The nice thing about environment variables is that most
corporate computer management systems already provide
ways to preset environment variables.)</p>
</div>
<div class="section" id="private-module-sha256s">
<h4>Private Module SHA256s<a class="headerlink" href="#private-module-sha256s" title="Permalink to this headline">¶</a></h4>
<p>Another possibility to reduce exposure is to support and
use by default an alternate lookup <code class="docutils literal notranslate"><span class="pre">/lookup/SHA256(module)&#64;version</span></code>,
which sends the SHA256 hash of the module path instead of the
module path instead.
If the database was already aware of that module path,
it would recognize the SHA256 and perform the lookup,
even potentially fetching a new version of the module.
If a misconfigured <code class="docutils literal notranslate"><span class="pre">go</span></code> command sends the SHA256 of
a private module path, that is far less information.</p>
<p>The SHA256 scheme does require, however, that the first use of a
public module be accompanied by some operation that sends
its module path text to the database, so that the database
can update its inverse-SHA256 index.
That operation—for now, let’s call it <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">notify</span> <span class="pre">&lt;modulepath&gt;</span></code>—would
need to be run just once ever across the whole Go ecosystem
for each module path.
Most likely the author would do it, perhaps as part of the
still-hypothetical <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">release</span></code> command,
or else the first user of the module would need to do it
(perhaps thinking carefully about being the first-ever user of the module!).</p>
<p>A modification of the SHA256 scheme might be to send a truncated hash,
designed to produce <a class="reference external" href="https://en.wikipedia.org/wiki/K-anonymity">K-anonymity</a>,
but this would cause significant expense:
if the database identified K public modules with the truncated hash,
it would have to look up the given version tag for all K of them
before returning an answer. This seems needlessly expensive
and of little practical benefit.
(An attacker might even create a long list of module paths
that collide with a popular module, just to slow down requests.)</p>
<p>The SHA256 + <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">notify</span></code> scheme is not part of this proposal today,
but we are considering adding it,
with full hashes, not truncated ones.</p>
</div>
<div class="section" id="public-module-usage-information">
<h4>Public Module Usage Information<a class="headerlink" href="#public-module-usage-information" title="Permalink to this headline">¶</a></h4>
<p>The second main privacy concern is that even developers who use only
public modules would expose information about their module usage habits
by requesting new <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> lines from the database.</p>
<p>Remember that the <code class="docutils literal notranslate"><span class="pre">go</span></code> command only contacts the database
in order to find new lines to add to <code class="docutils literal notranslate"><span class="pre">go.sum</span></code>.
When <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> is up-to-date, as it is during ordinary development,
the database is never contacted.
That is, the database is only involved at all when adding a new dependency
or changing the version of an existing one.
That significantly reduces the amount of usage information
being sent to the database in the first place.</p>
<p>Note also that even <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">get</span> <span class="pre">-u</span></code> does not request information
about every dependency from the database:
it only requests information about dependencies with
updates available.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">go</span></code> command will also cache database lookup results
(reauthenticating them against cached tiles at each use),
so that using a single computer to
upgrade the version of a particular dependency used by N different modules
will result in only one database lookup, not N.
That further reduces the strength of any usage signal.</p>
<p>One possible way to even further reduce the usage signal
observable by the database might be to use a truncated hash
for K-anonymity, as described in the previous section,
but the efficiency problems described earlier still apply.
Also, even if any particular fetch downloaded information
for K different module paths, the likely-very-lopsided popularity
distribution might make it easy to guess which module
path a typical client was really looking for,
especially combined with version information.
Truncated hashes appear to cost more than the benefit
they would bring.</p>
<p>The complete solution for not exposing either
private module path text or public module usage information
is to us a proxy or a bulk download.</p>
</div>
<div class="section" id="privacy-by-proxy">
<h4>Privacy by Proxy<a class="headerlink" href="#privacy-by-proxy" title="Permalink to this headline">¶</a></h4>
<p>A complete solution for database privacy concerns is to for
developers to access the database only through a proxy,
such as a local Athens instance or JFrog Artifactory instance,
assuming those proxies add support for proxying and
caching the Go database service endpoints.</p>
<p>The proxy can be configured with a list of private module patterns,
so that even requests from a misconfigured <code class="docutils literal notranslate"><span class="pre">go</span></code> command never
not make it past the proxy.
The database endpoints are designed for cacheability,
so that a proxy can avoid making any request more than once.
Requests for new versions of modules would still need to be
relayed to the database.</p>
<p>We anticipate that there will be many proxies available
for use in the Go ecosystem.
Part of the motivation for the Go checksum database is to allow
the use of any available proxy to download modules,
without any reduction in security.
Developers can then use any proxy they are comfortable using,
or run their own.</p>
</div>
<div class="section" id="privacy-by-bulk-download">
<h4>Privacy by Bulk Download<a class="headerlink" href="#privacy-by-bulk-download" title="Permalink to this headline">¶</a></h4>
<p>What little usage signal leaks from a proxy that aggressively caches
database queries can be removed entirely by instead downloading
the entire checksum database and answering requests using the
local copy.
We estimate that the Go ecosystem has around 3 million module versions.
At an estimated footprint of 200 bytes per module version,
a much larger, complete checksum database of even 100 million module versions would still only be 20 GB.
Bandwidth can be exchanged for complete anonymity
by downloading the full database once and thereafter updating it incrementally
(easy, since it is append-only).
Any queries can be answered using only the local copy,
ensuring that neither private module paths nor
public module usage is exposed.
The cost of this approach is the need for a clients to download the entire database
despite only needing an ever-smaller fraction of it.
(Today, assuming only a 3-million-entry database,
a module with even 100 dependencies would be downloading
30,000 times more database than it actually needs.
As the Go ecosystem grows, so too does the overhead factor.)</p>
<p>Downloading the entire database might be a good strategy
for a corporate proxy, however.</p>
</div>
<div class="section" id="privacy-in-ci-cd-systems">
<h4>Privacy in CI/CD Systems<a class="headerlink" href="#privacy-in-ci-cd-systems" title="Permalink to this headline">¶</a></h4>
<p>A question was raised about privacy of database operations especially
in CI/CD systems.
We expect that a CI/CD system would <em>never</em> contact the database.</p>
<p>First, in typical usage, you only push code to a CI/CD system after
first at least building (and hopefully also testing!) any changes locally.
Building any changes locally will update <code class="docutils literal notranslate"><span class="pre">go.mod</span></code> and <code class="docutils literal notranslate"><span class="pre">go.sum</span></code>
as needed, and then the <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> pushed to the CI/CD system
will be up-to-date. The database is only involved when adding to <code class="docutils literal notranslate"><span class="pre">go.sum</span></code>.</p>
<p>Second, module-aware CI/CD systems should already be using <code class="docutils literal notranslate"><span class="pre">-mod=readonly</span></code>,
to fail on out-of-date <code class="docutils literal notranslate"><span class="pre">go.mod</span></code> files instead of silently updating them.
We will ensure that <code class="docutils literal notranslate"><span class="pre">-mod=readonly</span></code> also fails on out-of-date <code class="docutils literal notranslate"><span class="pre">go.sum</span></code> files
if it does not already (<a class="reference external" href="https://golang.org/issue/30667">#30667</a>).</p>
</div>
</div>
</div>
<div class="section" id="compatibility">
<h2>Compatibility<a class="headerlink" href="#compatibility" title="Permalink to this headline">¶</a></h2>
<p>The introduction of the checksum database does not have any compatibility
concerns at the command or language level.
However, proxies that serve modified copies of public modules
will be incompatible with the new checks and stop being usable.
This is by design: such proxies are indistinguishable from man-in-the-middle attacks.</p>
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>The Go team at Google is working on a production implementation
of both a Go module proxy and the Go checksum database,
as we described in the blog post “<a class="reference external" href="https://blog.golang.org/modules2019">Go Modules in 2019</a>.”</p>
<p>We will publish a checksum database client as part of the <code class="docutils literal notranslate"><span class="pre">go</span></code> command,
as well as an example database implementation.
We intend to ship support for the checksum database, enabled by default, in Go 1.13.</p>
<p>Russ Cox will lead the <code class="docutils literal notranslate"><span class="pre">go</span></code> command integration
and has posted a <a class="reference external" href="https://go-review.googlesource.com/q/f:notary">stack of changes in golang.org/x/exp/notary</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="25719-go15vendor.html" class="btn btn-neutral float-right" title="Go 1.5 Vendor Experiment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="25530-notary.html" class="btn btn-neutral float-left" title="&lt;no title&gt;" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>