

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Proposal: Go 2 Number Literal Changes &mdash; Go Design Proposal  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Proposal: Mid-stack inlining in the Go compiler" href="19348-midstack-inlining.html" />
    <link rel="prev" title="Proposal: Permit Signed Integers as Shift Counts for Go 2" href="19113-signed-shift-counts.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Go Design Proposal
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="11502-securitypolicy.html">Proposal: Security Policy for Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="11970-decentralized-gc.html">Proposal: Decentralized GC coordination</a></li>
<li class="toctree-l1"><a class="reference internal" href="12166-subtests.html">Proposal: testing: programmatic sub-test and sub-benchmark support</a></li>
<li class="toctree-l1"><a class="reference internal" href="12302-release-proposal.html">Proposal: A minimal release process for Go repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="12416-cgo-pointers.html">Proposal: Rules for passing pointers between Go and C</a></li>
<li class="toctree-l1"><a class="reference internal" href="12750-localization.html">Proposal: Localization support in Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="12800-sweep-free-alloc.html">Proposal: Dense mark bits and sweep-free allocation</a></li>
<li class="toctree-l1"><a class="reference internal" href="12914-monotonic.html">Proposal: Monotonic Elapsed Time Measurements in Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="12914-monotonic.html#appendix-time-now-usage">Appendix: time.Now usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="13073-code-of-conduct.html">Proposal: A Code of Conduct for the Go community</a></li>
<li class="toctree-l1"><a class="reference internal" href="13432-mobile-audio.html">Proposal: Audio for Mobile</a></li>
<li class="toctree-l1"><a class="reference internal" href="13504-natural-xml.html">Proposal: Natural XML</a></li>
<li class="toctree-l1"><a class="reference internal" href="14313-benchmark-format.html">Proposal: Go Benchmark Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="14386-zip-package-archives.html">Proposal: Zip-based Go package archives</a></li>
<li class="toctree-l1"><a class="reference internal" href="14951-soft-heap-limit.html">Proposal: Separate soft and hard heap size goal</a></li>
<li class="toctree-l1"><a class="reference internal" href="15292-generics.html">Proposal: Go should have generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="16085-conversions-ignore-tags.html">Proposal: Ignore tags in struct type conversions</a></li>
<li class="toctree-l1"><a class="reference internal" href="16339-alias-decls.html">Proposal: Alias declarations for Go</a></li>
<li class="toctree-l1"><a class="reference internal" href="16339-alias-decls.html#appendix">Appendix</a></li>
<li class="toctree-l1"><a class="reference internal" href="16410-heap-viewer.html">Proposal: Go Heap Dump Viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="16704-cidr-notation-no-proxy.html">Proposal: Add support for CIDR notation in no_proxy variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="17280-profile-labels.html">Proposal: Support for pprof profiler labels</a></li>
<li class="toctree-l1"><a class="reference internal" href="17503-eliminate-rescan.html">Proposal: Eliminate STW stack re-scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="17505-concurrent-rescan.html">Proposal: Concurrent stack re-scanning</a></li>
<li class="toctree-l1"><a class="reference internal" href="18130-type-alias.html">Proposal: Type Aliases</a></li>
<li class="toctree-l1"><a class="reference internal" href="18802-percpu-sharded.html">Proposal: percpu.Sharded, an API for reducing cache contention</a></li>
<li class="toctree-l1"><a class="reference internal" href="18802-percpu-sharded.html#discussion">Discussion</a></li>
<li class="toctree-l1"><a class="reference internal" href="18802-percpu-sharded.html#backwards-compatibility">Backwards compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="19113-signed-shift-counts.html">Proposal: Permit Signed Integers as Shift Counts for Go 2</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Proposal: Go 2 Number Literal Changes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#abstract">Abstract</a></li>
<li class="toctree-l2"><a class="reference internal" href="#background">Background</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#binary-integer-literals">Binary Integer Literals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#octal-integer-literals">Octal Integer Literals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hexadecimal-floating-point">Hexadecimal Floating-Point</a></li>
<li class="toctree-l3"><a class="reference internal" href="#digit-separators">Digit Separators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#proposal">Proposal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#language-changes">Language Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#library-changes">Library Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tool-changes">Tool Changes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#rationale">Rationale</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#octal-literals">Octal Literals</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arbitrary-bases">Arbitrary Bases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Library Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Digit Separators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compatibility">Compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementation">Implementation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html">Proposal: Mid-stack inlining in the Go compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#abstract">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#background">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#proposal">Proposal</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#rationale">Rationale</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#compatibility">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#implementation">Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#prerequisite-changes">Prerequisite Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#preliminary-results">Preliminary Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="19348-midstack-inlining.html#open-issues">Open issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="19480-xml-stream.html">Proposal: XML Stream</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html">Proposal: emit DWARF inlining info in the Go compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#abstract">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#background">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#example">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#how-the-generated-dwarf-should-look">How the generated DWARF should look</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#outline-of-proposed-changes">Outline of proposed changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#compatibility">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#implementation">Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#prerequisite-changes">Prerequisite Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#preliminary-results">Preliminary Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="22080-dwarf-inlining.html#open-issues">Open issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="24301-versioned-go.html">Proposal: Versioned Go Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="24543-non-cooperative-preemption.html">Proposal: Non-cooperative goroutine preemption</a></li>
<li class="toctree-l1"><a class="reference internal" href="25530-sumdb.html">Proposal: Secure the Public Go Module Ecosystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="25719-go15vendor.html">Go 1.5 Vendor Experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="26160-dns-based-vanity-imports.html">Proposal: DNS Based Vanity Imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="26756-rawxml-token.html">Proposal: Raw XML Token</a></li>
<li class="toctree-l1"><a class="reference internal" href="26903-simplify-mark-termination.html">Proposal: Simplify mark termination and eliminate mark 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="27539-internal-abi.html">Proposal: Create an undefined internal calling convention</a></li>
<li class="toctree-l1"><a class="reference internal" href="2775-binary-only-packages.html">Proposal: Binary-Only Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="27935-unbounded-queue-package.html">Proposal: Built in support for high performance unbounded queue</a></li>
<li class="toctree-l1"><a class="reference internal" href="28221-go2-transitions.html">Proposal: Go 2 transition</a></li>
<li class="toctree-l1"><a class="reference internal" href="2981-go-test-json.html">Proposal: <code class="docutils literal notranslate"><span class="pre">-json</span></code> flag in <code class="docutils literal notranslate"><span class="pre">go</span> <span class="pre">test</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="29934-error-values.html">Proposal: Go 2 Error Inspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="30333-smarter-scavenging.html">Proposal: Smarter Scavenging</a></li>
<li class="toctree-l1"><a class="reference internal" href="30411-env.html">Proposal: <code class="docutils literal notranslate"><span class="pre">go</span></code> command configuration file</a></li>
<li class="toctree-l1"><a class="reference internal" href="32437-try-builtin.html">Proposal: A built-in Go error check function, <code class="docutils literal notranslate"><span class="pre">try</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="33974-add-public-lockedfile-pkg.html">Proposal: make the internal lockedfile package public</a></li>
<li class="toctree-l1"><a class="reference internal" href="34481-opencoded-defers.html">Proposal: Low-cost defers through inline code, and extra funcdata to manage the panic case</a></li>
<li class="toctree-l1"><a class="reference internal" href="35112-scaling-the-page-allocator.html">Proposal: Scaling the Go page allocator</a></li>
<li class="toctree-l1"><a class="reference internal" href="36460-lazy-module-loading.html">Proposal: Lazy Module Loading</a></li>
<li class="toctree-l1"><a class="reference internal" href="36606-64-bit-field-alignment.html">Proposal: Make 64-bit fields be 64-bit aligned on 32-bit systems, add //go:packed, //go:align directives</a></li>
<li class="toctree-l1"><a class="reference internal" href="37112-unstable-runtime-metrics.html">Proposal: API for unstable runtime metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="37720-gopls-workspaces.html">Proposal: Multi-project gopls workspaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="4899-testing-helper.html">Proposal: testing: better support test helper functions with TB.Helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="6282-table-data.html">Proposal: Multi-dimensional slices</a></li>
<li class="toctree-l1"><a class="reference internal" href="6977-overlapping-interfaces.html">Proposal: Permit embedding of interfaces with overlapping method sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="TEMPLATE.html">Proposal: [Title]</a></li>
<li class="toctree-l1"><a class="reference internal" href="cryptography-principles.html">Cryptography Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft.html">Go 2 Draft Designs</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-contracts.html">Contracts — Draft Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-handling.html">Error Handling — Draft Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-handling-overview.html">Error Handling — Problem Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-inspection.html">Error Inspection — Draft Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-printing.html">Error Printing — Draft Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-error-values-overview.html">Error Values — Problem Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-generics-overview.html">Generics — Problem Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="go2draft-type-parameters.html">Type Parameters - Draft Design</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Go Design Proposal</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Proposal: Go 2 Number Literal Changes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/19308-number-literals.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="proposal-go-2-number-literal-changes">
<h1>Proposal: Go 2 Number Literal Changes<a class="headerlink" href="#proposal-go-2-number-literal-changes" title="Permalink to this headline">¶</a></h1>
<p>Russ Cox<br />Robert Griesemer</p>
<p>Last updated: March 6, 2019</p>
<p><a class="reference external" href="https://golang.org/design/19308-number-literals">golang.org/design/19308-number-literals</a></p>
<p>Discussion at:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://golang.org/issue/19308">golang.org/issue/19308</a> (binary integer literals)</p></li>
<li><p><a class="reference external" href="https://golang.org/issue/12711">golang.org/issue/12711</a> (octal integer literals)</p></li>
<li><p><a class="reference external" href="https://golang.org/issue/28493">golang.org/issue/28493</a> (digit separator)</p></li>
<li><p><a class="reference external" href="https://golang.org/issue/29008">golang.org/issue/29008</a> (hexadecimal floating point)</p></li>
</ul>
<div class="section" id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¶</a></h2>
<p>We propose four related changes to number literals in Go:</p>
<ol class="simple">
<li><p>Add binary integer literals, as in 0b101.</p></li>
<li><p>Add alternate octal integer literals, as in 0o377.</p></li>
<li><p>Add hexadecimal floating-point literals, as in 0x1p-1021.</p></li>
<li><p>Allow _ as a digit separator in number literals.</p></li>
</ol>
</div>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Go adopted C’s number literal syntax and in so doing
joined a large group of widely-used languages
that all broadly agree about how numbers are written.
The group of such “C-numbered languages” includes at least
C, C++, C#, Java, JavaScript, Perl, PHP, Python, Ruby, Rust, and Swift.</p>
<p>In the decade since Go’s initial design,
nearly all the C-numbered languages have extended
their number literals to add one or more of the four changes in this proposal.
Extending Go in the same way makes it easier for developers
to move between these languages, eliminating an unnecessary rough edge
without adding significant complexity to the language.</p>
<div class="section" id="binary-integer-literals">
<h3>Binary Integer Literals<a class="headerlink" href="#binary-integer-literals" title="Permalink to this headline">¶</a></h3>
<p>The idea of writing a program’s integer literals in binary is quite old,
dating back at least to
<a class="reference external" href="http://www.bitsavers.org/pdf/ibm/npl/320-0908_NPL_Technical_Report_Dec64.pdf">PL/I (1964)</a>, which used <code class="docutils literal notranslate"><span class="pre">'01111000'B</span></code>.</p>
<p>In C’s lineage,
<a class="reference external" href="http://www.ancientgeek.org.uk/CPL/CPL_Elementary_Programming_Manual.pdf">CPL (1966)</a>
supported decimal, binary, and octal integers.
Binary and octal were introduced by an underlined 2 or 8 prefix.
<a class="reference external" href="http://web.eah-jena.de/~kleine/history/languages/Richards-BCPL-ReferenceManual.pdf">BCPL (1967)</a> removed binary but retained octal,
still introduced by an 8 (it’s unclear whether the 8 was underlined or followed by a space).
<a class="reference external" href="https://www.bell-labs.com/usr/dmr/www/kbman.html">B (1972)</a>
introduced the leading zero syntax for octal, as in <code class="docutils literal notranslate"><span class="pre">0377</span></code>.
<a class="reference external" href="http://cm.bell-labs.co/who/dmr/cman74.pdf">C as of 1974</a> had only decimal and octal.
Hexadecimal <code class="docutils literal notranslate"><span class="pre">0x12ab</span></code> had been added by the time
<a class="reference external" href="http://www.ccapitalia.net/descarga/docs/1978-ritchie-the-c-programming-language.pdf">K&amp;R (1978)</a>
was published.
Possibly the earliest use of the exact <code class="docutils literal notranslate"><span class="pre">0b01111000</span></code> syntax was in
<a class="reference external" href="https://discuss.ocaml.org/t/the-origin-of-the-0b-01-notation/3180/2">Caml Light 0.5 (1992)</a>,
which was written in C and borrowed <code class="docutils literal notranslate"><span class="pre">0x12ab</span></code> for hexadecimal.</p>
<p>Binary integer literals using the <code class="docutils literal notranslate"><span class="pre">0b01111000</span></code> syntax were added in
<a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3472.pdf">C++14 (2014)</a>,
<a class="reference external" href="https://blogs.msdn.microsoft.com/dotnet/2017/03/09/new-features-in-c-7-0/">C# 7.0 (2017)</a>,
<a class="reference external" href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/binary-literals.html">Java 7 (2011)</a>,
<a class="reference external" href="http://www.ecma-international.org/ecma-262/6.0/#sec-literals-numeric-literals">JavaScript ES6 (2015)</a>,
<a class="reference external" href="https://perl5.git.perl.org/perl.git/commitdiff/4f19785bce4da39a768aa6210f1f97ab4c0600dd">Perl 5.005_55 (1998)</a>,
<a class="reference external" href="http://php.net/manual/en/language.types.integer.php">PHP 5.4.0 (2012)</a>,
<a class="reference external" href="https://docs.python.org/2.7/whatsnew/2.6.html#pep-3127-integer-literal-support-and-syntax">Python 2.6 (2008)</a>,
<a class="reference external" href="https://github.com/ruby/ruby/blob/v1_4_0/ChangeLog#L647">Ruby 1.4.0 (1999)</a>,
<a class="reference external" href="https://github.com/rust-lang/rust/blob/release-0.1/doc/rust.md#integer-literals">Rust 0.1 or earlier (2012)</a>,
and
<a class="reference external" href="https://carlosicaza.com/swiftbooks/SwiftLanguage.pdf">Swift 1.0 or earlier (2014)</a>.</p>
<p>The syntax is a leading <code class="docutils literal notranslate"><span class="pre">0b</span></code> prefix followed by some number of 0s and 1s.
There is no corresponding character escape sequence
(that is, no <code class="docutils literal notranslate"><span class="pre">'\b01111000'</span></code> for <code class="docutils literal notranslate"><span class="pre">'x'</span></code>, since <code class="docutils literal notranslate"><span class="pre">'\b'</span></code> is already used for backspace, U+0008).
Most languages also updated their integer parsing and formatting routines to support binary forms as well.</p>
<p>Although C++14 added binary integer literals, C itself has not, <a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg14/www/abq/c17_updated_proposed_fdis.pdf">as of C18</a>.</p>
</div>
<div class="section" id="octal-integer-literals">
<h3>Octal Integer Literals<a class="headerlink" href="#octal-integer-literals" title="Permalink to this headline">¶</a></h3>
<p>As noted earlier, octal was the
most widely-used form for writing bit patterns
in the early days of computing
(after binary itself).
Even though octal today is far less common,
B’s introduction of <code class="docutils literal notranslate"><span class="pre">0377</span></code> as syntax for octal carried forward into
C, C++, Go, Java, JavaScript, Python, Perl, PHP, and Ruby.
But because programmers don’t see octal much,
it sometimes comes as a surprise that
<code class="docutils literal notranslate"><span class="pre">01234</span></code> is not 1234 decimal or that <code class="docutils literal notranslate"><span class="pre">08</span></code> is a syntax error.</p>
<p><a class="reference external" href="https://discuss.ocaml.org/t/the-origin-of-the-0b-01-notation/3180/2">Caml Light 0.5 (1992)</a>,
mentioned above
as possibly the earliest language with <code class="docutils literal notranslate"><span class="pre">0b01111000</span></code> for binary,
may also have been the first to use the analogous notation <code class="docutils literal notranslate"><span class="pre">0o377</span></code> for octal.</p>
<p><a class="reference external" href="https://www.ecma-international.org/publications/files/ECMA-ST-ARCH/ECMA-262,%203rd%20edition,%20December%201999.pdf">JavaScript ES3 (1999)</a>
technically removed support for <code class="docutils literal notranslate"><span class="pre">0377</span></code> as octal,
but of course allowed implementations to continue recognizing them.
<a class="reference external" href="https://www.ecma-international.org/publications/files/ECMA-ST-ARCH/ECMA-262%205th%20edition%20December%202009.pdf">ES5 (2009)</a>
added “strict mode,” in which, among other restrictions, octal literals are disallowed entirely
(<code class="docutils literal notranslate"><span class="pre">0377</span></code> is an error, not decimal).
<a class="reference external" href="https://www.ecma-international.org/ecma-262/6.0/index.html#sec-literals-numeric-literals">ES6 (2015)</a>
introduced the <code class="docutils literal notranslate"><span class="pre">0o377</span></code> syntax, allowed even in strict mode.</p>
<p><a class="reference external" href="https://www.python.org/download/releases/early/">Python’s initial release (1991)</a>
used <code class="docutils literal notranslate"><span class="pre">0377</span></code> syntax for octal.
<a class="reference external" href="https://docs.python.org/3.0/reference/lexical_analysis.html#integer-and-long-integer-literals">Python 3 (2008)</a>
changed the syntax to <code class="docutils literal notranslate"><span class="pre">0o377</span></code>,
removing the <code class="docutils literal notranslate"><span class="pre">0377</span></code> syntax (<code class="docutils literal notranslate"><span class="pre">0377</span></code> is an error, not decimal).
<a class="reference external" href="https://docs.python.org/2.7/reference/lexical_analysis.html#integer-and-long-integer-literals">Python 2.7 (2010)</a>
backported <code class="docutils literal notranslate"><span class="pre">0o377</span></code> as an alternate octal syntax (<code class="docutils literal notranslate"><span class="pre">0377</span></code> is still supported).</p>
<p><a class="reference external" href="https://github.com/rust-lang/rust/blob/release-0.1/doc/rust.md#integer-literals">Rust (2012)</a>
initially had no octal syntax but added <code class="docutils literal notranslate"><span class="pre">0o377</span></code> in
<a class="reference external" href="https://github.com/rust-lang/rust/blob/0.9/doc/rust.md#integer-literals">Rust 0.9 (2014)</a>.
<a class="reference external" href="https://carlosicaza.com/swiftbooks/SwiftLanguage.pdf">Swift’s initial release (2014)</a> used <code class="docutils literal notranslate"><span class="pre">0o377</span></code> for octal.
Both Rust and Swift allow decimals to have leading zeros (<code class="docutils literal notranslate"><span class="pre">0377</span></code> is decimal 377),
creating a potential point of confusion for programmers coming from
other C-numbered languages.</p>
</div>
<div class="section" id="hexadecimal-floating-point">
<h3>Hexadecimal Floating-Point<a class="headerlink" href="#hexadecimal-floating-point" title="Permalink to this headline">¶</a></h3>
<p>The exact decimal floating-point literal syntax of C and its successors (<code class="docutils literal notranslate"><span class="pre">1.23e4</span></code>)
appears to have originated at IBM in
<a class="reference external" href="https://archive.computerhistory.org/resources/text/Fortran/102649787.05.01.acc.pdf">Fortran (1956)</a>,
some time after the
<a class="reference external" href="https://archive.computerhistory.org/resources/text/Fortran/102679231.05.01.acc.pdf">1954 draft</a>.
The syntax was not used in
<a class="reference external" href="http://web.eah-jena.de/~kleine/history/languages/Algol60-Naur.pdf">Algol 60 (1960)</a>
but was adopted by <a class="reference external" href="http://www.bitsavers.org/pdf/ibm/npl/320-0908_NPL_Technical_Report_Dec64.pdf">PL/I (1964)</a>
and
<a class="reference external" href="http://web.eah-jena.de/~kleine/history/languages/Algol68-Report.pdf">Algol 68 (1968)</a>,
and it spread from those into many other languages.</p>
<p>Hexadecimal floating-point literals appear to have originated in
<a class="reference external" href="http://www.open-std.org/jtc1/sc22/WG14/www/docs/n1256.pdf">C99 (1999)</a>,
spreading to
<a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0245r0.html">C++17 (2017)</a>,
<a class="reference external" href="http://psc.informatik.uni-jena.de/languages/Java/javaspec-3.pdf">Java 5 (2004)</a>
<a class="reference external" href="https://perldoc.perl.org/perl5220delta.html#Floating-point-parsing-has-been-improved">Perl 5.22 (2015)</a>,
and
<a class="reference external" href="https://carlosicaza.com/swiftbooks/SwiftLanguage.pdf">Swift’s initial release (2014)</a>.
<a class="reference external" href="http://www.dsc.ufcg.edu.br/~cnum/modulos/Modulo2/IEEE754_2008.pdf">IEEE 754-2008</a>
also added hexadecimal floating-point literals, citing C99.</p>
<p>All these languages use the syntax <code class="docutils literal notranslate"><span class="pre">0x123.fffp5</span></code>,
where the “<code class="docutils literal notranslate"><span class="pre">pN</span></code>” specifies a decimal number interpreted as a power of two:
<code class="docutils literal notranslate"><span class="pre">0x123.fffp5</span></code> is (0x123 + 0xfff/0x1000) x 2^5.
In all languages, the exponent is required: <code class="docutils literal notranslate"><span class="pre">0x123.fff</span></code> is not a valid hexadecimal floating-point literal.</p>
<p>The fraction may be omitted, as in <code class="docutils literal notranslate"><span class="pre">0x1p-1000</span></code>.
C, C++, Java, Perl, and the IEEE 754-2008 standard
allow omitting the digits before or after the hexadecimal point:
<code class="docutils literal notranslate"><span class="pre">0x1.p0</span></code> and <code class="docutils literal notranslate"><span class="pre">0x.fp0</span></code> are valid hexadecimal floating-point literals
just as <code class="docutils literal notranslate"><span class="pre">1.</span></code> and <code class="docutils literal notranslate"><span class="pre">.9</span></code> are valid decimal literals.
Swift requires digits on both sides of a decimal or hexadecimal point;
that is, in Swift, <code class="docutils literal notranslate"><span class="pre">0x1.p0</span></code>, <code class="docutils literal notranslate"><span class="pre">0x.fp0</span></code>, <code class="docutils literal notranslate"><span class="pre">1.</span></code>, and <code class="docutils literal notranslate"><span class="pre">.9</span></code> are all invalid.</p>
<p>Adding hexadecimal floating-point literals also requires adding library support.
C99 added the <code class="docutils literal notranslate"><span class="pre">%a</span></code> and <code class="docutils literal notranslate"><span class="pre">%A</span></code> <code class="docutils literal notranslate"><span class="pre">printf</span></code> formats for formatting and <code class="docutils literal notranslate"><span class="pre">%a</span></code> for scanning.
It also redefined <code class="docutils literal notranslate"><span class="pre">strtod</span></code> to accept hexadecimal floating-point values.
The other languages made similar changes.</p>
<p>C# (as of C# 7.3, which has <a class="reference external" href="https://github.com/dotnet/csharplang/issues/64">no published language specification</a>),
JavaScript (as of <a class="reference external" href="https://www.ecma-international.org/ecma-262/8.0/index.html#sec-literals-numeric-literals">ES8</a>),
PHP (as of <a class="reference external" href="http://php.net/manual/en/language.types.float.php">PHP 7.3.0</a>),
Python (as of <a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#floating-point-literals">Python 3.7.2</a>),
Ruby (as of <a class="reference external" href="https://docs.ruby-lang.org/en/2.6.0/syntax/literals_rdoc.html#label-Numbers">Ruby 2.6.0</a>),
and
Rust (as of <a class="reference external" href="https://doc.rust-lang.org/stable/reference/tokens.html#floating-point-literals">Rust 1.31.1</a>)
do not support hexadecimal floating-point literals.</p>
</div>
<div class="section" id="digit-separators">
<h3>Digit Separators<a class="headerlink" href="#digit-separators" title="Permalink to this headline">¶</a></h3>
<p>Allowing the use of an underscore to separate digits in a number literal into groups dates back at least to
<a class="reference external" href="http://archive.adaic.com/standards/83rat/html/ratl-02-01.html#2.1">Ada 83</a>, possibly earlier.</p>
<p>A digit-separating underscore was added to
<a class="reference external" href="https://blogs.msdn.microsoft.com/dotnet/2017/03/09/new-features-in-c-7-0/">C# 7.0 (2017)</a>,
<a class="reference external" href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/underscores-literals.html">Java 7 (2011)</a>,
<a class="reference external" href="https://perl5.git.perl.org/perl.git/blob/378cc40b38293ffc7298c6a7ed3cd740ad79be52:/toke.c#l1021">Perl 2.0 (1988)</a>,
<a class="reference external" href="https://www.python.org/dev/peps/pep-0515/">Python 3.6 (2016)</a>,
<a class="reference external" href="https://github.com/ruby/ruby/blob/v1_0/parse.y#L2282">Ruby 1.0 or earlier (1998)</a>,
<a class="reference external" href="https://github.com/rust-lang/rust/blob/release-0.1/doc/rust.md#integer-literals">Rust 0.1 or earlier (2012)</a>,
and
<a class="reference external" href="https://carlosicaza.com/swiftbooks/SwiftLanguage.pdf">Swift 1.0 or earlier (2014)</a>.</p>
<p>C has not yet added digit separators as of C18.
C++14 uses
<a class="reference external" href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3781.pdf">single-quote as a digit separator</a>
to avoid an ambiguity with C++11 user-defined integer suffixes
that might begin with underscore.
JavaScript is
<a class="reference external" href="https://github.com/tc39/proposal-numeric-separator">considering adding underscore as a digit separator</a>
but ran into a similar problem with user-defined suffixes.
PHP <a class="reference external" href="https://wiki.php.net/rfc/number_format_separator">considered but decided against</a> adding digit separators.</p>
<p>The design space for a digit separator feature reduces to four questions:
(1) whether to accept a separator immediately after the single-digit octal <code class="docutils literal notranslate"><span class="pre">0</span></code> base prefix, as in <code class="docutils literal notranslate"><span class="pre">0_1</span></code>;
(2) whether to accept a separator immediately after non-digit base prefixes like <code class="docutils literal notranslate"><span class="pre">0b</span></code>, <code class="docutils literal notranslate"><span class="pre">0o</span></code>, and <code class="docutils literal notranslate"><span class="pre">0x</span></code>, as in <code class="docutils literal notranslate"><span class="pre">0x_1</span></code>;
(3) whether to accept multiple separators in a row, as in <code class="docutils literal notranslate"><span class="pre">1__2</span></code>; and
(4) whether to accept trailing separators, as in <code class="docutils literal notranslate"><span class="pre">1_</span></code>.
(Note that a “leading separator” would create a variable name, as in _1.)
These four questions produce sixteen possible approaches.</p>
<p>Case 0b0001:
If the name “digit separator” is understood literally,
so that each underscore must separate (appear between) digits,
then the answers should be that <code class="docutils literal notranslate"><span class="pre">0_1</span></code> is allowed but <code class="docutils literal notranslate"><span class="pre">0x_1</span></code>, <code class="docutils literal notranslate"><span class="pre">1__2</span></code>, and <code class="docutils literal notranslate"><span class="pre">1_</span></code> are all disallowed.
This is the approach taken by
<a class="reference external" href="http://archive.adaic.com/standards/83lrm/html/lrm-02-04.html#2.4">Ada 83</a>
(using <code class="docutils literal notranslate"><span class="pre">8#123#</span></code> for octal and so avoiding question 1),
<a class="reference external" href="http://eel.is/c++draft/lex.icon">C++14</a>,
<a class="reference external" href="https://docs.oracle.com/javase/7/docs/technotes/guides/language/underscores-literals.html">Java 7</a>,
and
<a class="reference external" href="https://docs.swift.org/swift-book/ReferenceManual/LexicalStructure.html#ID415">Swift</a>
(using only <code class="docutils literal notranslate"><span class="pre">0o</span></code> for octal and thereby also avoiding question 1).</p>
<p>Case 0b0011:
If we harmonize the treatment of the <code class="docutils literal notranslate"><span class="pre">0</span></code> octal base prefix
with the <code class="docutils literal notranslate"><span class="pre">0b</span></code>, <code class="docutils literal notranslate"><span class="pre">0o</span></code>, and <code class="docutils literal notranslate"><span class="pre">0x</span></code> base prefixes by allowing a digit separator
between a base prefix and leading digit,
then the answers are that <code class="docutils literal notranslate"><span class="pre">0_1</span></code> and <code class="docutils literal notranslate"><span class="pre">0x_1</span></code> are allowed but <code class="docutils literal notranslate"><span class="pre">1__2</span></code> and <code class="docutils literal notranslate"><span class="pre">1_</span></code> are disallowed.
This is the approach taken in
<a class="reference external" href="https://www.python.org/dev/peps/pep-0515/#literal-grammar">Python 3.6</a> and
<a class="reference external" href="https://github.com/ruby/ruby/blob/v1_8_0/parse.y#L3723">Ruby 1.8.0</a>.</p>
<p>Case 0b0111:
If we allow runs of multiple separators as well, that allows <code class="docutils literal notranslate"><span class="pre">0_1</span></code>, <code class="docutils literal notranslate"><span class="pre">0x_1</span></code>,
and <code class="docutils literal notranslate"><span class="pre">1__2</span></code>, but not <code class="docutils literal notranslate"><span class="pre">1_</span></code>.
This is the approach taken in
<a class="reference external" href="https://github.com/dotnet/csharplang/blob/master/proposals/csharp-7.2/leading-separator">C# 7.2</a>
and
<a class="reference external" href="https://github.com/ruby/ruby/blob/v1_6_2/parse.y#L2779">Ruby 1.6.2</a>.</p>
<p>Case 0b1111:
If we then also accept trailing digit separators,
the implementation becomes trivial: ignore digit separators wherever they appear.
<a class="reference external" href="https://perl5.git.perl.org/perl.git/blob/378cc40b38293ffc7298c6a7ed3cd740ad79be52:/toke.c#l1021">Perl</a>
takes this approach,
as does <a class="reference external" href="https://swift.godbolt.org/z/1f72LH">Rust</a>.</p>
<p>Other combinations have been tried:
<a class="reference external" href="https://github.com/dotnet/csharplang/blob/master/proposals/csharp-7.0/digit-separators">C# 7.0</a>
used 0b0101 (<code class="docutils literal notranslate"><span class="pre">0x_1</span></code> and <code class="docutils literal notranslate"><span class="pre">1_</span></code> disallowed)
before moving to case 0b1110 in
<a class="reference external" href="https://github.com/dotnet/csharplang/blob/master/proposals/csharp-7.2/leading-separator">C# 7.2</a>.
<a class="reference external" href="https://github.com/ruby/ruby/blob/v1_0/parse.y#L2282">Ruby 1.0</a>
used 0b1110 (only <code class="docutils literal notranslate"><span class="pre">0_1</span></code> disallowed)
and
<a class="reference external" href="https://github.com/ruby/ruby/blob/v1_3_1_/parse.y#L2779">Ruby 1.3.1</a>
used 0b1101 (only <code class="docutils literal notranslate"><span class="pre">0x_1</span></code> disallowed),
before Ruby 1.6.2 tried 0b0111 and Ruby 1.8.0 settled on 0b0011.</p>
<p>A similar question arises for whether to allow underscore between
a decimal point and a decimal digit in a floating-point number,
or between the literal <code class="docutils literal notranslate"><span class="pre">e</span></code> and the exponent.
We won’t enumerate the cases here, but again languages
make surprising choices.
For example, in Rust, <code class="docutils literal notranslate"><span class="pre">1_.2</span></code> is valid but <code class="docutils literal notranslate"><span class="pre">1._2</span></code> is not.</p>
</div>
</div>
<div class="section" id="proposal">
<h2>Proposal<a class="headerlink" href="#proposal" title="Permalink to this headline">¶</a></h2>
<p>We propose to add binary integer literals,
to add octal <code class="docutils literal notranslate"><span class="pre">0o377</span></code> as an alternate octal literal syntax,
to add hexadecimal floating-point literals,
and to add underscore as a base-prefix-or-digit separator
(case 0b0011 above; see rationale below),
along with appropriate library support.
Finally, to fit the existing imaginary literals seemlessly
into the new number literals, we propose that the imaginary
suffix <code class="docutils literal notranslate"><span class="pre">i</span></code> may be used on any (non-imaginary) number literal.</p>
<div class="section" id="language-changes">
<h3>Language Changes<a class="headerlink" href="#language-changes" title="Permalink to this headline">¶</a></h3>
<p>The definitions in https://golang.org/ref/spec#Letters_and_digits add:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">binary_digit</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="o">|</span> <span class="s2">&quot;1&quot;</span> <span class="o">.</span>
</pre></div>
</div>
</div></blockquote>
<p>The https://golang.org/ref/spec#Integer_literals section would be amended to read:</p>
<blockquote>
<div><p>An integer literal is a sequence of digits representing an integer constant.
An optional prefix sets a non-decimal base:
0, 0o, or 0O for octal, 0b or 0B for binary, 0x or 0X for hexadecimal.
A single 0 is considered a decimal zero.
In hexadecimal literals, letters a-f and A-F represent values 10 through 15.
For readability, an underscore may appear after a base prefix or
between successive digits; such underscores do not change the literal value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>int_lit        = decimal_lit | binary_lit | octal_lit | hex_lit .
decimal_lit    = &quot;0&quot; | ( &quot;1&quot; … &quot;9&quot; ) [ [ &quot;_&quot; ] decimal_digits ] .
binary_lit     = &quot;0&quot; ( &quot;b&quot; | &quot;B&quot; ) [ &quot;_&quot; ] binary_digits .
octal_lit      = &quot;0&quot; [ &quot;o&quot; | &quot;O&quot; ] [ &quot;_&quot; ] octal_digits .
hex_lit        = &quot;0&quot; ( &quot;x&quot; | &quot;X&quot; ) [ &quot;_&quot; ] hex_digits .

decimal_digits = decimal_digit { [ &quot;_&quot; ] decimal_digit } .
binary_digits  = binary_digit { [ &quot;_&quot; ] binary_digit } .
octal_digits   = octal_digit { [ &quot;_&quot; ] octal_digit } .
hex_digits     = hex_digit { [ &quot;_&quot; ] hex_digit } .

42
4_2
0600
0_600
0o600
0O600       // second character is capital letter &#39;O&#39;
0xBadFace
0xBad_Face
0x_67_7a_2f_cc_40_c6
170141183460469231731687303715884105727
170_141183_460469_231731_687303_715884_105727

_42         // an identifier, not an integer literal
42_         // invalid: _ must separate successive digits
4__2        // invalid: only one _ at a time
0_xBadFace  // invalid: _ must separate successive digits
</pre></div>
</div>
</div></blockquote>
<p>The https://golang.org/ref/spec#Floating-point_literals section would be amended to read:</p>
<blockquote>
<div><p>A floating-point literal is a decimal or hexadecimal representation
of a floating-point constant.
A decimal floating-point literal consists of
an integer part (decimal digits),
a decimal point,
a fractional part (decimal digits)
and an exponent part (e or E followed by an optional sign and decimal digits).
One of the integer part or the fractional part may be elided;
one of the decimal point or the exponent part may be elided.
A hexadecimal floating-point literal consists of
a 0x or 0X prefix,
an integer part (hexadecimal digits),
a decimal point,
a fractional part (hexadecimal digits),
and an exponent part (p or P followed by an optional sign and decimal digits).
One of the integer part or the fractional part may be elided;
the decimal point may be elided as well, but the exponent part is required.
(This syntax matches the one given in
<a class="reference external" href="https://doi.org/10.1109/IEEESTD.2008.4610935">IEEE 754-2008</a> §5.12.3.)
For readability, an underscore may appear after a base prefix or
between successive digits; such underscores do not change the literal value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">float_lit</span>         <span class="o">=</span> <span class="n">decimal_float_lit</span> <span class="o">|</span> <span class="n">hex_float_lit</span> <span class="o">.</span>

<span class="n">decimal_float_lit</span> <span class="o">=</span> <span class="n">decimal_digits</span> <span class="s2">&quot;.&quot;</span> <span class="p">[</span> <span class="n">decimal_digits</span> <span class="p">]</span> <span class="p">[</span> <span class="n">decimal_exponent</span> <span class="p">]</span> <span class="o">|</span>
                    <span class="n">decimal_digits</span> <span class="n">decimal_exponent</span> <span class="o">|</span>
                    <span class="s2">&quot;.&quot;</span> <span class="n">decimal_digits</span> <span class="p">[</span> <span class="n">decimal_exponent</span> <span class="p">]</span> <span class="o">.</span>
<span class="n">decimal_exponent</span>  <span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;e&quot;</span> <span class="o">|</span> <span class="s2">&quot;E&quot;</span> <span class="p">)</span> <span class="p">[</span> <span class="s2">&quot;+&quot;</span> <span class="o">|</span> <span class="s2">&quot;-&quot;</span> <span class="p">]</span> <span class="n">decimal_digits</span> <span class="o">.</span>

<span class="n">hex_float_lit</span>     <span class="o">=</span> <span class="s2">&quot;0&quot;</span> <span class="p">(</span> <span class="s2">&quot;x&quot;</span> <span class="o">|</span> <span class="s2">&quot;X&quot;</span> <span class="p">)</span> <span class="n">hex_mantissa</span> <span class="n">hex_exponent</span> <span class="o">.</span>
<span class="n">hex_mantissa</span>      <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;_&quot;</span> <span class="p">]</span> <span class="n">hex_digits</span> <span class="s2">&quot;.&quot;</span> <span class="p">[</span> <span class="n">hex_digits</span> <span class="p">]</span> <span class="o">|</span>
                    <span class="p">[</span> <span class="s2">&quot;_&quot;</span> <span class="p">]</span> <span class="n">hex_digits</span> <span class="o">|</span>
                    <span class="s2">&quot;.&quot;</span> <span class="n">hex_digits</span> <span class="o">.</span>
<span class="n">hex_exponent</span>      <span class="o">=</span> <span class="p">(</span> <span class="s2">&quot;p&quot;</span> <span class="o">|</span> <span class="s2">&quot;P&quot;</span> <span class="p">)</span> <span class="p">[</span> <span class="s2">&quot;+&quot;</span> <span class="o">|</span> <span class="s2">&quot;-&quot;</span> <span class="p">]</span> <span class="n">decimal_digits</span> <span class="o">.</span>


<span class="mf">0.</span>
<span class="mf">72.40</span>
<span class="mf">072.40</span>       <span class="o">//</span> <span class="o">==</span> <span class="mf">72.40</span>
<span class="mf">2.71828</span>
<span class="mf">1.e+0</span>
<span class="mf">6.67428e-11</span>
<span class="mf">1E6</span>
<span class="o">.</span><span class="mi">25</span>
<span class="o">.</span><span class="mf">12345E+5</span>
<span class="mf">1_5.</span>         <span class="o">//</span> <span class="o">==</span> <span class="mf">15.0</span>
<span class="mf">0.15e+0_2</span>    <span class="o">//</span> <span class="o">==</span> <span class="mf">15.0</span>

<span class="mh">0x1</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span>       <span class="o">//</span> <span class="o">==</span> <span class="mf">0.25</span>
<span class="mh">0x2</span><span class="o">.</span><span class="n">p10</span>      <span class="o">//</span> <span class="o">==</span> <span class="mf">2048.0</span>
<span class="mh">0x1</span><span class="o">.</span><span class="n">Fp</span><span class="o">+</span><span class="mi">0</span>     <span class="o">//</span> <span class="o">==</span> <span class="mf">1.9375</span>
<span class="mi">0</span><span class="n">X</span><span class="o">.</span><span class="mi">8</span><span class="n">p</span><span class="o">-</span><span class="mi">0</span>      <span class="o">//</span> <span class="o">==</span> <span class="mf">0.5</span>
<span class="mh">0X_1FFF</span><span class="n">P</span><span class="o">-</span><span class="mi">16</span>  <span class="o">//</span> <span class="o">==</span> <span class="mf">0.1249847412109375</span>
<span class="mh">0x15e</span><span class="o">-</span><span class="mi">2</span>      <span class="o">//</span> <span class="o">==</span> <span class="mh">0x15e</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">(</span><span class="n">integer</span> <span class="n">subtraction</span><span class="p">)</span>

<span class="mi">0</span><span class="n">x</span><span class="o">.</span><span class="n">p1</span>        <span class="o">//</span> <span class="n">invalid</span><span class="p">:</span> <span class="n">mantissa</span> <span class="n">has</span> <span class="n">no</span> <span class="n">digits</span>
<span class="mi">1</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span>         <span class="o">//</span> <span class="n">invalid</span><span class="p">:</span> <span class="n">p</span> <span class="n">exponent</span> <span class="n">requires</span> <span class="n">hexadecimal</span> <span class="n">mantissa</span>
<span class="mh">0x1</span><span class="o">.</span><span class="mf">5e-2</span>     <span class="o">//</span> <span class="n">invalid</span><span class="p">:</span> <span class="n">hexadecimal</span> <span class="n">mantissa</span> <span class="n">requires</span> <span class="n">p</span> <span class="n">exponent</span>
<span class="mi">1</span><span class="n">_</span><span class="o">.</span><span class="mi">5</span>         <span class="o">//</span> <span class="n">invalid</span><span class="p">:</span> <span class="n">_</span> <span class="n">must</span> <span class="n">separate</span> <span class="n">successive</span> <span class="n">digits</span>
<span class="mf">1.</span><span class="n">_5</span>         <span class="o">//</span> <span class="n">invalid</span><span class="p">:</span> <span class="n">_</span> <span class="n">must</span> <span class="n">separate</span> <span class="n">successive</span> <span class="n">digits</span>
<span class="mf">1.5</span><span class="n">_e1</span>       <span class="o">//</span> <span class="n">invalid</span><span class="p">:</span> <span class="n">_</span> <span class="n">must</span> <span class="n">separate</span> <span class="n">successive</span> <span class="n">digits</span>
<span class="mf">1.5</span><span class="n">e_1</span>       <span class="o">//</span> <span class="n">invalid</span><span class="p">:</span> <span class="n">_</span> <span class="n">must</span> <span class="n">separate</span> <span class="n">successive</span> <span class="n">digits</span>
<span class="mf">1.5e1</span><span class="n">_</span>       <span class="o">//</span> <span class="n">invalid</span><span class="p">:</span> <span class="n">_</span> <span class="n">must</span> <span class="n">separate</span> <span class="n">successive</span> <span class="n">digits</span>
</pre></div>
</div>
</div></blockquote>
<p>The syntax in https://golang.org/ref/spec#Imaginary_literals section would be amended to read:</p>
<blockquote>
<div><p>An imaginary literal represents the imaginary part of a complex constant.
It consists of an integer or floating-point literal followed by the lower-case
letter i.
The value of an imaginary literal is the value of the respective
integer or floating-point literal multiplied by the imaginary unit i.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">imaginary_lit</span> <span class="o">=</span> <span class="p">(</span><span class="n">decimal_digits</span> <span class="o">|</span> <span class="n">int_lit</span> <span class="o">|</span> <span class="n">float_lit</span><span class="p">)</span> <span class="s2">&quot;i&quot;</span> <span class="o">.</span>
</pre></div>
</div>
<p>For backward-compatibility, an imaginary literal’s integer part consisting
entirely of decimal digits (and possibly underscores) is considered a decimal
integer, not octal, even if it starts with a leading 0.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span><span class="n">i</span>
<span class="mi">0123</span><span class="n">i</span>         <span class="o">//</span> <span class="o">==</span> <span class="mi">123</span><span class="n">i</span> <span class="k">for</span> <span class="n">backward</span><span class="o">-</span><span class="n">compatibility</span>
<span class="mo">0o123</span><span class="n">i</span>        <span class="o">//</span> <span class="o">==</span> <span class="mo">0o123</span> <span class="o">*</span> <span class="mi">1</span><span class="n">i</span> <span class="o">==</span> <span class="mi">83</span><span class="n">i</span>
<span class="mh">0xabc</span><span class="n">i</span>        <span class="o">//</span> <span class="o">==</span> <span class="mh">0xabc</span> <span class="o">*</span> <span class="mi">1</span><span class="n">i</span> <span class="o">==</span> <span class="mi">2748</span><span class="n">i</span>
<span class="mf">0.</span><span class="n">i</span>
<span class="mf">2.71828</span><span class="n">i</span>
<span class="mf">1.e+0</span><span class="n">i</span>
<span class="mf">6.67428e-11</span><span class="n">i</span>
<span class="mf">1E6</span><span class="n">i</span>
<span class="o">.</span><span class="mi">25</span><span class="n">i</span>
<span class="o">.</span><span class="mf">12345E+5</span><span class="n">i</span>
<span class="mh">0x1</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="n">i</span>       <span class="o">//</span> <span class="o">==</span> <span class="mh">0x1</span><span class="n">p</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1</span><span class="n">i</span> <span class="o">==</span> <span class="mf">0.25</span><span class="n">i</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="library-changes">
<h3>Library Changes<a class="headerlink" href="#library-changes" title="Permalink to this headline">¶</a></h3>
<p>In <a class="reference external" href="https://golang.org/pkg/fmt/"><code class="docutils literal notranslate"><span class="pre">fmt</span></code></a>,
<a class="reference external" href="https://golang.org/pkg/fmt/#Printf"><code class="docutils literal notranslate"><span class="pre">Printf</span></code></a> with <code class="docutils literal notranslate"><span class="pre">%#b</span></code>
will format an integer argument in binary with a leading <code class="docutils literal notranslate"><span class="pre">0b</span></code> prefix.
Today, <a class="reference external" href="https://play.golang.org/p/3MPBPo2sZu9"><code class="docutils literal notranslate"><span class="pre">%b</span></code> already formats an integer in binary</a>
with no prefix;
<a class="reference external" href="https://play.golang.org/p/wwPshrf3oae"><code class="docutils literal notranslate"><span class="pre">%#b</span></code> does the same</a>
but is rejected by <code class="docutils literal notranslate"><span class="pre">go</span></code> <code class="docutils literal notranslate"><span class="pre">vet</span></code>, including during <code class="docutils literal notranslate"><span class="pre">go</span></code> <code class="docutils literal notranslate"><span class="pre">test</span></code>,
so redefining <code class="docutils literal notranslate"><span class="pre">%#b</span></code> will not break vetted, tested programs.</p>
<p><code class="docutils literal notranslate"><span class="pre">Printf</span></code> with <code class="docutils literal notranslate"><span class="pre">%#o</span></code> is already defined to format an
integer argument in octal with a leading <code class="docutils literal notranslate"><span class="pre">0</span></code> (not <code class="docutils literal notranslate"><span class="pre">0o</span></code>) prefix,
and all the other available format flags have defined effects too.
It appears no change is possible here.
Clients can use <code class="docutils literal notranslate"><span class="pre">0o%o</span></code>, at least for non-negative arguments.</p>
<p><code class="docutils literal notranslate"><span class="pre">Printf</span></code> with <code class="docutils literal notranslate"><span class="pre">%x</span></code>
will format a floating-point argument in hexadecimal floating-point syntax.
(Today, <code class="docutils literal notranslate"><span class="pre">%x</span></code> on a floating-point argument formats as a <code class="docutils literal notranslate"><span class="pre">%!x</span></code> error
and also provokes a vet error.)
<a class="reference external" href="https://golang.org/pkg/fmt/#Scanf"><code class="docutils literal notranslate"><span class="pre">Scanf</span></code></a> will accept
both decimal and hexadecimal floating-point forms
where it currently accepts decimal.</p>
<p>In <a class="reference external" href="https://golang.org/pkg/go/scanner/"><code class="docutils literal notranslate"><span class="pre">go/scanner</span></code></a>,
the implementation must change to understand the
new syntax, but the public API needs no changes.
Because <a class="reference external" href="https://golang.org/pkg/text/scanner/"><code class="docutils literal notranslate"><span class="pre">text/scanner</span></code></a>
recognizes Go’s number syntax as well,
it will be updated to add the new numbers too.</p>
<p>In <a class="reference external" href="https://golang.org/pkg/math/big/"><code class="docutils literal notranslate"><span class="pre">math/big</span></code></a>,
<a class="reference external" href="https://golang.org/pkg/math/big/#Int.SetString"><code class="docutils literal notranslate"><span class="pre">Int.SetString</span></code></a>
with <code class="docutils literal notranslate"><span class="pre">base</span></code> set to zero accepts binary integer literals already;
it will change to recognize the new octal prefix and the underscore digit separator.
<a class="reference external" href="https://golang.org/pkg/math/big/#ParseParse"><code class="docutils literal notranslate"><span class="pre">ParseFloat</span></code></a> and
<a class="reference external" href="https://golang.org/pkg/math/big/#Float.Parse"><code class="docutils literal notranslate"><span class="pre">Float.Parse</span></code></a> with <code class="docutils literal notranslate"><span class="pre">base</span></code> set to zero,
<a class="reference external" href="https://golang.org/pkg/math/big/#Float.SetString"><code class="docutils literal notranslate"><span class="pre">Float.SetString</span></code></a>,
and <a class="reference external" href="https://golang.org/pkg/math/big/#Rat.SetString"><code class="docutils literal notranslate"><span class="pre">Rat.SetString</span></code></a> each
accept binary integer literals and hexadecimal floating-point literals already;
they will change to recognize the new octal prefix and the underscore digit separator.
Calls using non-zero bases will continue to reject inputs with underscores.</p>
<p>In <a class="reference external" href="https://golang.org/pkg/strconv/"><code class="docutils literal notranslate"><span class="pre">strconv</span></code></a>,
<a class="reference external" href="https://golang.org/pkg/strconv/#ParseInt"><code class="docutils literal notranslate"><span class="pre">ParseInt</span></code></a>
and
<a class="reference external" href="https://golang.org/pkg/strconv/#ParseUint"><code class="docutils literal notranslate"><span class="pre">ParseUint</span></code></a>
will change behavior.
When the <code class="docutils literal notranslate"><span class="pre">base</span></code> argument is zero,
they will recognize binary literals like <code class="docutils literal notranslate"><span class="pre">0b0111</span></code>
and also allow underscore as a digit separator.
Calls using non-zero bases will continue to reject inputs with underscores.
<a class="reference external" href="https://golang.org/pkg/strconv/#ParseFloat"><code class="docutils literal notranslate"><span class="pre">ParseFloat</span></code></a>
will change to accept hexadecimal floating-point literals and
the underscore digit separator.
<a class="reference external" href="https://golang.org/pkg/strconv/#FormatFloat"><code class="docutils literal notranslate"><span class="pre">FormatFloat</span></code></a>
will add a new format <code class="docutils literal notranslate"><span class="pre">x</span></code> to generate hexadecimal floating-point.</p>
<p>In <a class="reference external" href="https://golang.org/pkg/text/template/parse"><code class="docutils literal notranslate"><span class="pre">text/template/parse</span></code></a>,
<code class="docutils literal notranslate"><span class="pre">(*lex).scanNumber</span></code> will need to recognize the three new syntaxes.
This will provide the new literals to both
<a class="reference external" href="https://golang.org/pkg/html/template/"><code class="docutils literal notranslate"><span class="pre">html/template</span></code></a>
and
<a class="reference external" href="https://golang.org/pkg/html/template/"><code class="docutils literal notranslate"><span class="pre">text/template</span></code></a>.</p>
</div>
<div class="section" id="tool-changes">
<h3>Tool Changes<a class="headerlink" href="#tool-changes" title="Permalink to this headline">¶</a></h3>
<p>Gofmt will understand the new syntax once
<a class="reference external" href="https://golang.org/pkg/go/scanner/"><code class="docutils literal notranslate"><span class="pre">go/scanner</span></code></a>
is updated.
For legibility,
gofmt will also rewrite capitalized base prefixes <code class="docutils literal notranslate"><span class="pre">0B</span></code>, <code class="docutils literal notranslate"><span class="pre">0O</span></code>, and <code class="docutils literal notranslate"><span class="pre">0X</span></code>
and exponent prefixes <code class="docutils literal notranslate"><span class="pre">E</span></code> and <code class="docutils literal notranslate"><span class="pre">P</span></code>
to their lowercase equivalents <code class="docutils literal notranslate"><span class="pre">0b</span></code>, <code class="docutils literal notranslate"><span class="pre">0o</span></code>, <code class="docutils literal notranslate"><span class="pre">0x</span></code>, <code class="docutils literal notranslate"><span class="pre">e</span></code>, and <code class="docutils literal notranslate"><span class="pre">p</span></code>.
This is especially important for <code class="docutils literal notranslate"><span class="pre">0O377</span></code> vs <code class="docutils literal notranslate"><span class="pre">0o377</span></code>.</p>
<p>To avoid introducing incompatibilities into
otherwise backward-compatible code,
gofmt will not rewrite <code class="docutils literal notranslate"><span class="pre">0377</span></code> to <code class="docutils literal notranslate"><span class="pre">0o377</span></code>.
(Perhaps in a few years we will be able to consider doing that.)</p>
</div>
</div>
<div class="section" id="rationale">
<h2>Rationale<a class="headerlink" href="#rationale" title="Permalink to this headline">¶</a></h2>
<p>As discussed in the background section,
the choices being made in this proposal
match those already made in Go’s broader language family.
Making these same changes to Go is useful on its own
and avoids unnecessary lexical differences with the
other languages.
This is the primary rationale for all four changes.</p>
<div class="section" id="octal-literals">
<h3>Octal Literals<a class="headerlink" href="#octal-literals" title="Permalink to this headline">¶</a></h3>
<p>We considered using <code class="docutils literal notranslate"><span class="pre">0o377</span></code> in the initial design of Go,
but we decided that even if Go used <code class="docutils literal notranslate"><span class="pre">0o377</span></code>
for octal, it would have to reject <code class="docutils literal notranslate"><span class="pre">0377</span></code> as invalid syntax
(that is, Go could not accept <code class="docutils literal notranslate"><span class="pre">0377</span></code> as decimal 377),
to avoid an unpleasant surprise for programmers coming
from C, C++, Java, Python 2, Perl, PHP, Ruby, and so on.
Given that <code class="docutils literal notranslate"><span class="pre">0377</span></code> cannot be decimal,
it seemed at the time unnecessary
and gratuitously different to avoid it for octal.
It still seemed that way in 2015, when the issue
was raised as <a class="reference external" href="https://golang.org/issue/12711">golang.org/issue/12711</a>.</p>
<p>Today, however, it seems clear that there is agreement
among at least the newer C-numbered languages
for <code class="docutils literal notranslate"><span class="pre">0o377</span></code> as octal (either alone or in addition to <code class="docutils literal notranslate"><span class="pre">0377</span></code>).
Harmonizing Go’s octal integer syntax with these languages
makes sense for the same reasons as harmonizing
the binary integer and hexadecimal floating-point syntax.</p>
<p>For backwards compatibility,
we must keep the existing <code class="docutils literal notranslate"><span class="pre">0377</span></code> syntax in Go 1,
so Go will have two octal integer syntaxes,
like Python 2.7 and non-strict JavaScript.
As noted earlier,
after a few years, once there are no supported Go releases
missing the <code class="docutils literal notranslate"><span class="pre">0o377</span></code> syntax,
we could consider changing
<code class="docutils literal notranslate"><span class="pre">gofmt</span></code> to at least reformat <code class="docutils literal notranslate"><span class="pre">0377</span></code> to <code class="docutils literal notranslate"><span class="pre">0o377</span></code> for clarity.</p>
</div>
<div class="section" id="arbitrary-bases">
<h3>Arbitrary Bases<a class="headerlink" href="#arbitrary-bases" title="Permalink to this headline">¶</a></h3>
<p>Another obvious change is to consider
arbitrary-radix numbers, like Algol 68’s <code class="docutils literal notranslate"><span class="pre">2r101</span></code>.
Perhaps the form most in keeping with Go’s history
would be to allow <code class="docutils literal notranslate"><span class="pre">BxDIGITS</span></code> where <code class="docutils literal notranslate"><span class="pre">B</span></code> is the base,
as in <code class="docutils literal notranslate"><span class="pre">2x0101</span></code>, <code class="docutils literal notranslate"><span class="pre">8x377</span></code>, and <code class="docutils literal notranslate"><span class="pre">16x12ab</span></code>,
where <code class="docutils literal notranslate"><span class="pre">0x</span></code> becomes an alias for <code class="docutils literal notranslate"><span class="pre">16x</span></code>.
We considered this in the initial design of Go,
but it seemed gratuitously
different from the common C-numbered languages,
and it would still not let us interpret <code class="docutils literal notranslate"><span class="pre">0377</span></code> as decimal.
It also seemed that very few programs would be
aided by being able to write numbers in, say,
base 3 or base 36.
That logic still holds today,
reinforced by the weight of existing Go usage.
Better to add only the syntaxes that other languages use.
For discussion, see <a class="reference external" href="https://golang.org/issue/28256">golang.org/issue/28256</a>.</p>
</div>
<div class="section" id="id1">
<h3>Library Changes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>In the library changes, the various number parsers
are changed to accept underscores only in the base-detecting case.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;12_34&quot;</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="n">decimal</span> <span class="k">with</span> <span class="n">underscores</span>
<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;0b11_00&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="n">binary</span> <span class="k">with</span> <span class="n">underscores</span>
<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;012_34&quot;</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="mi">01234</span> <span class="p">(</span><span class="n">octal</span><span class="p">)</span>
<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;0o12_34&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="mo">0o1234</span> <span class="p">(</span><span class="n">octal</span><span class="p">)</span>
<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;0x12_34&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="mh">0x1234</span> <span class="p">(</span><span class="n">hexadecimal</span><span class="p">)</span>

<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;12_34&quot;</span><span class="p">,</span>  <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="n">error</span><span class="p">:</span> <span class="n">fixed</span> <span class="n">base</span> <span class="n">cannot</span> <span class="n">use</span> <span class="n">underscores</span>
<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;11_00&quot;</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="n">error</span><span class="p">:</span> <span class="n">fixed</span> <span class="n">base</span> <span class="n">cannot</span> <span class="n">use</span> <span class="n">underscores</span>
<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;12_34&quot;</span><span class="p">,</span>   <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="n">error</span><span class="p">:</span> <span class="n">fixed</span> <span class="n">base</span> <span class="n">cannot</span> <span class="n">use</span> <span class="n">underscores</span>
<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;12_34&quot;</span><span class="p">,</span>  <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="n">error</span><span class="p">:</span> <span class="n">fixed</span> <span class="n">base</span> <span class="n">cannot</span> <span class="n">use</span> <span class="n">underscores</span>
</pre></div>
</div>
<p>Note that the fixed-base case also rejects base prefixes (and always has):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;0b1100&quot;</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="n">error</span><span class="p">:</span> <span class="n">fixed</span> <span class="n">base</span> <span class="n">cannot</span> <span class="n">use</span> <span class="n">base</span> <span class="n">prefix</span>
<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;0o1100&quot;</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="n">error</span><span class="p">:</span> <span class="n">fixed</span> <span class="n">base</span> <span class="n">cannot</span> <span class="n">use</span> <span class="n">base</span> <span class="n">prefix</span>
<span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="s2">&quot;0x1234&quot;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="o">//</span> <span class="n">error</span><span class="p">:</span> <span class="n">fixed</span> <span class="n">base</span> <span class="n">cannot</span> <span class="n">use</span> <span class="n">base</span> <span class="n">prefix</span>
</pre></div>
</div>
<p>The rationale for rejecting underscores when the base is known
is the same as the rationale for rejecting base prefixes:
the caller is likely to be parsing a substring of a larger
input and would not appreciate the “flexibility.”
For example, parsing hex bytes two digits at a time
might use <code class="docutils literal notranslate"><span class="pre">strconv.ParseInt(input[i:i+2],</span> <span class="pre">16,</span> <span class="pre">8)</span></code>,
and parsers for various text formats
use <code class="docutils literal notranslate"><span class="pre">strconv.ParseInt(field,</span> <span class="pre">10,</span> <span class="pre">64)</span></code>
to parse a plain decimal number.
These use cases should not be required to guard
against underscores in the inputs themselves.</p>
<p>On the other hand,
uses of <code class="docutils literal notranslate"><span class="pre">strconv.ParseInt</span></code> and <code class="docutils literal notranslate"><span class="pre">strconv.ParseUint</span></code> with <code class="docutils literal notranslate"><span class="pre">base</span></code> argument zero
already accept decimal, octal <code class="docutils literal notranslate"><span class="pre">0377</span></code>, and hexadecimal literals,
so they will start accepting the new binary and octal literals
and digit-separating underscores.
For example, command line flags defined with <code class="docutils literal notranslate"><span class="pre">flag.Int</span></code> will start
accepting these inputs.
Similarly, uses of <code class="docutils literal notranslate"><span class="pre">strconv.ParseFloat</span></code>, like <code class="docutils literal notranslate"><span class="pre">flag.Float64</span></code>
or the conversion of string-typed database entries to <code class="docutils literal notranslate"><span class="pre">float64</span></code>
in <a class="reference external" href="https://golang.org/pkg/database/sql/"><code class="docutils literal notranslate"><span class="pre">database/sql</span></code></a>,
will start accepting hexadecimal floating-point literals
and digit-separating underscores.</p>
</div>
<div class="section" id="id2">
<h3>Digit Separators<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The main bike shed to paint is the detail about
where exactly digit separators are allowed.
Following discussion on <a class="reference external" href="https://golang.org/issue/19308">golang.org/issue/19308</a>,
and matching the latest versions of Python and Ruby,
this proposal adopts the rule
that each digit separator must separate
a digit from the base prefix or another digit:
<code class="docutils literal notranslate"><span class="pre">0_1</span></code>, <code class="docutils literal notranslate"><span class="pre">0x_1</span></code>, and <code class="docutils literal notranslate"><span class="pre">1_2</span></code> are all allowed, while <code class="docutils literal notranslate"><span class="pre">1__2</span></code> and <code class="docutils literal notranslate"><span class="pre">1_</span></code> are not.</p>
</div>
</div>
<div class="section" id="compatibility">
<h2>Compatibility<a class="headerlink" href="#compatibility" title="Permalink to this headline">¶</a></h2>
<p>The syntaxes being introduced here were all previously invalid,
either syntactically or semantically.
For an example of the latter,
<code class="docutils literal notranslate"><span class="pre">0x1.fffp-2</span></code> parses in current versions of Go
as the value <code class="docutils literal notranslate"><span class="pre">0x1</span></code>’s <code class="docutils literal notranslate"><span class="pre">fffp</span></code> field minus two.
Of course, integers have no fields, so while this program
is syntactically valid, it is still semantically invalid.</p>
<p>The changes to numeric parsing functions like
<code class="docutils literal notranslate"><span class="pre">strconv.ParseInt</span></code> and <code class="docutils literal notranslate"><span class="pre">strconv.ParseFloat</span></code>
mean that programs that might have failed before
on inputs like <code class="docutils literal notranslate"><span class="pre">0x1.fffp-2</span></code> or <code class="docutils literal notranslate"><span class="pre">1_2_3</span></code> will now succeed.
Some users may be surprised.
Part of the rationale with limiting the changes
to calls using <code class="docutils literal notranslate"><span class="pre">base</span></code> zero is to limit the potential surprise
to those cases that already accepted multiple syntaxes.</p>
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>The implementation requires:</p>
<ul class="simple">
<li><p>Language specification changes, detailed above.</p></li>
<li><p>Library changes, detailed above.</p></li>
<li><p>Compiler changes, in gofrontend and cmd/compile/internal/syntax.</p></li>
<li><p>Testing of compiler changes, library changes, and gofmt.</p></li>
</ul>
<p>Robert Griesemer and Russ Cox plan to split the work
and aim to have all the changes ready at the start of the Go 1.13 cycle,
around February 1.</p>
<p>As noted in our blog post
<a class="reference external" href="https://blog.golang.org/go2-here-we-come">“Go 2, here we come!”</a>,
the development cycle will serve as a way to collect experience about
these new features and feedback from (very) early adopters.</p>
<p>At the release freeze, May 1, we will revisit the proposed features
and decide whether to include them in Go 1.13.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="19348-midstack-inlining.html" class="btn btn-neutral float-right" title="Proposal: Mid-stack inlining in the Go compiler" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="19113-signed-shift-counts.html" class="btn btn-neutral float-left" title="Proposal: Permit Signed Integers as Shift Counts for Go 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>